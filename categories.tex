\chapter{范畴论 (Category theory)}
\label{cha:category-theory}

在数学的各个分支中，范畴论可能是最不适合基于集合论基础的学科之一。
一个问题是，大多数范畴论的内容在弱于等同性的“相同”概念下是不变的，例如范畴中的同构或者范畴之间的等价，而集合论无法捕捉这一点。
但是，对于类型论中的等同性，无效性公理 (univalence axiom) 通过将等同性与等价性等同解决了类似的问题。
因此，在无效性基础 (univalent foundations) 中，考虑一种“范畴”概念是合理的，在这种范畴中，对象的等同性与同构被以类似的方式识别。

忽略大小问题，在基于集合的数学中，范畴由一个对象的\emph{集合} $A_0$ 和对于每个 $x,y\in A_0$ 的\emph{集合} $\hom_A(x,y)$ 组成。
在无效性基础下，一个“朴素的”范畴定义只是模仿这个结构，用一个\emph{类型}的对象和\emph{类型}的态射。
如果我们允许这些类型包含任意的高阶同伦，则应当引入更高的连贯条件，从而导向某种 $(\infty,1)$-范畴的概念，\index{.infinity1-category@$(\infty,1)$-范畴}%
但目前我们的目标更加温和。我们只考虑 1-范畴，因此我们将 $\hom_A(x,y)$ 的类型限制为集合，即 0-类型。如果我们不施加进一步的条件，我们将这种概念称为\emph{预范畴}。

如果我们添加条件，使得对象类型 $A_0$ 是一个集合，那么我们得到一个行为与传统集合论定义相似的定义。
我们称这种概念为\emph{严格范畴} (strict category)。
\index{严格!范畴 (strict category)}%
或者，我们可以要求无效性公理的广义版本，将 $(x=_{A_0} y)$ 与 $x$ 到 $y$ 的同构类型 $\mathsf{iso}(x,y)$ 识别。
由于我们认为后一种选择通常是“正确的”定义，因此我们简单地称它为\emph{范畴}。

一个关于这三种范畴概念的区别的好例子是“每个满忠实且本质满的函子是范畴等价”的命题，在经典基于集合的范畴论中，该命题等价于选择公理。
\index{数学!经典 (mathematics!classical)}%
\index{公理!选择 (axiom!of choice)}%
\index{经典!范畴论 (classical!category theory)}%
\begin{enumerate}
  \item 对于严格范畴，这一命题仍然等价于选择公理。
  \item 对于预范畴，没有一致的选择公理可以使其成立。
  \item 对于范畴，它可以\emph{不使用}任何选择公理的情况下被证明。
\end{enumerate}
我们将在本章中证明最后一个命题，并讨论范畴的其他令人愉快的性质，例如等价范畴是相等的（作为范畴类型的元素）。
我们还将描述一种将预范畴 $A$“饱和”成范畴 $\widehat A$ 的通用方式，我们称之为它的\emph{Rezk 完成}，\index{完成!Rezk (completion!Rezk)}%
尽管它也可以合理地称为\emph{栈完成}（见注释）。

Rezk 完成还进一步阐明了范畴等价的概念。
例如，函子 $A \to \widehat{A}$ 始终是满忠实且本质满的，因此是“弱等价”。
因此，一个预范畴是范畴的必要和充分条件是它“视”所有满忠实且本质满的函子为等价；因此我们的“范畴”概念已经内在于“满忠实且本质满函子”的概念之中。

我们假定读者对经典范畴论有一定的基本了解。 \index{经典!范畴论 (classical!category theory)}
请记住，每当我们写到 \type 时，它表示某个类型的宇宙，但在不同情况下可能是不同的宇宙；我们所说的一切都对任何一致的宇宙层次的选择成立。\index{宇宙层次 (universe level)}
我们将使用 \cref{cha:typetheory,cha:basics} 中的同伦类型论的基本概念以及 \cref{cha:logic} 中的命题截断，但不会涉及 \cref{part:foundations} 的大部分内容，除非我们将在第二种 Rezk 完成的构造中使用高阶归纳类型。

\section{范畴与预范畴 (Categories and precategories)}
\label{sec:cats}

在经典数学中，有许多等价的范畴定义。
在我们的情况下，由于我们有依赖类型，因此将箭头作为对象的类型族是很自然的。
这与范畴论中 Hom-类型的使用方式相匹配：我们在比较两个箭头之前从未考虑过它们的域和陪域是否一致。
此外，显然，对于 1-范畴理论，所有的 Hom-类型都应该是集合。
这引导我们到以下定义。

\begin{defn}\label{ct:precategory}
一个\define{预范畴 (precategory)}\indexdef{预范畴 (precategory)}$A$ 包含以下内容。
\begin{enumerate}
  \item 一个类型 $A_0$，其元素称为\define{对象 (objects)}。%
  \indexdef{对象!在(预)范畴中 (object!in a (pre)category)}
  我们记 $a:A$ 表示 $a:A_0$。
  \item 对于每个 $a,b:A$，有一个集合 $\hom_A(a,b)$，其元素称为\define{箭头 (arrows)} 或\define{态射 (morphisms)}。%
  \indexsee{箭头}{态射}%
  \indexdef{态射!在(预)范畴中 (morphism!in a (pre)category)}%
  \indexdef{同态集 (hom-set)}%
  \item 对于每个 $a:A$，有一个态射 $1_a:\hom_A(a,a)$，称为\define{恒等态射 (identity morphism)}。%
  \indexdef{恒等!在(预)范畴中 (identity!morphism in a (pre)category)}
  \item 对于每个 $a,b,c:A$，有一个函数%
  \indexdef{态射的复合在(预)范畴中 (composition!of morphisms in a (pre)category)}
  \[  \hom_A(b,c) \to \hom_A(a,b) \to \hom_A(a,c) \]
  称为\define{复合 (composition)}，记为中缀形式 $g\mapsto f\mapsto g\circ f$，有时简单记为 $gf$。
  \item 对于每个 $a,b:A$ 和 $f:\hom_A(a,b)$，我们有 $\id f {1_b\circ f}$ 和 $\id f {f\circ 1_a}$。
  \item 对于每个 $a,b,c,d:A$ 和
  \begin{equation*}
    f:\hom_A(a,b), \qquad
    g:\hom_A(b,c), \qquad
    h:\hom_A(c,d),
  \end{equation*}
  我们有 $\id {h\circ (g\circ f)}{(h\circ g)\circ f}$。
\end{enumerate}
\end{defn}

预范畴的一个问题是，对于对象 $a,b:A$，我们有两种可能不同的“相同”概念。
一方面，我们有类型 $(\id[A_0]{a}{b})$。
但另一方面，有标准的范畴论中的\emph{同构 (isomorphism)}的概念。

\begin{defn}\label{ct:isomorphism}
态射 $f:\hom_A(a,b)$ 是一个\define{同构 (isomorphism)}\indexdef{同构!在(预)范畴中 (isomorphism!in a (pre)category)}%
如果存在态射 $g:\hom_A(b,a)$ 使得 $\id{g\circ f}{1_a}$ 和 $\id{f\circ g}{1_b}$。
我们记 $a\cong b$ 表示这种同构的类型。
\end{defn}

\begin{lem}\label{ct:isoprop}
对于任意 $f:\hom_A(a,b)$，类型“$f$ 是同构”是一个单命题。
因此，对于任意 $a,b:A$，类型 $a\cong b$ 是一个集合。
\end{lem}
\begin{proof}
  假设给定 $g:\hom_A(b,a)$ 和 $\eta:(\id{1_a}{g\circ f})$ 以及 $\epsilon:(\id{f\circ g}{1_b})$，类似地有 $g'$，$\eta'$ 和 $\epsilon'$。
  我们必须证明 $\id{(g,\eta,\epsilon)}{(g',\eta',\epsilon')}$。
  但由于所有同态集都是集合，因此它们的等同性类型是单命题，所以只需证明 $\id g {g'}$。
  为此我们有
  \[g' = 1_a\circ g' = (g\circ f)\circ g' = g\circ (f\circ g') = g\circ 1_b = g\]
  使用 $\eta$ 和 $\epsilon'$。
\end{proof}

\symlabel{ct:inv}
\index{逆在(预)范畴中 (inverse!in a (pre)category)}%
如果 $f:a\cong b$，我们记 $\inv f$ 表示它的逆，由 \cref{ct:isoprop} 唯一确定。

在预范畴中，这两种相同性概念之间的唯一关系如下。

\begin{lem}[\textsf{idtoiso}]\label{ct:idtoiso}
如果 $A$ 是一个预范畴，$a,b:A$，则
\[(\id a b)\to (a \cong b)\]。
\end{lem}
\begin{proof}
  通过等同性归纳，我们可以假设 $a$ 和 $b$ 是相同的。
  但是在这种情况下，我们有 $1_a:\hom_A(a,a)$，它显然是一个同构。
\end{proof}

显然，这种情况类似于促使我们引入无效性公理的问题。
实际上，我们有以下例子：

\begin{eg}\label{ct:precatset}
\index{集合 (set)}%
存在一个预范畴 \uset，其对象的类型是 \set，并且 $\hom_{\uset}(A,B) \defeq (A\to B)$。
恒等态射是恒等函数，复合是函数复合。
对于这个预范畴，\cref{ct:idtoiso} 等同于（限制到集合的）来自 \cref{sec:compute-universe} 中的 $\idtoeqv$。

当然，更准确地说，我们应该称这个范畴为 $\uset_\UU$，因为它的对象仅是相对于某个宇宙 \UU 的\emph{小集合}。\index{小!集合 (small!set)}%
\end{eg}

因此，引入以下定义是合乎逻辑的。

\begin{defn}\label{ct:category}
一个\define{范畴 (category)}\indexdef{范畴 (category)}是一个预范畴，使得对于所有 $a,b:A$，\cref{ct:idtoiso} 中的函数 $\idtoiso_{a,b}$ 是一个等价。
\end{defn}

特别是，在一个范畴中，如果 $a\cong b$，那么 $a=b$。

\begin{eg}\label{ct:eg:set}
\index{无效性公理 (univalence axiom)}%
无效性公理立即蕴含 \uset 是一个范畴。
还可以通过无效性公理证明，任何集合层次的结构（如群、环、拓扑空间等）的预范畴都是一个范畴；见 \cref{sec:sip}。
\end{eg}

我们还注意到以下内容。

\begin{lem}\label{ct:obj-1type}
在一个范畴中，对象的类型是一个 1-类型。
\end{lem}
\begin{proof}
  证明对于任意 $a,b:A$，类型 $\id a b$ 是一个集合即可。
  但 $\id a b$ 等价于 $a \cong b$，而后者是一个集合。
\end{proof}

\symlabel{isotoid}
我们记 $\isotoid$ 为 \cref{ct:idtoiso} 中从 $(a\cong b)$ 到 $(\id a b)$ 的逆。
以下关系非常重要。

\begin{lem}\label{ct:idtoiso-trans}
对于 $p:\id a a'$ 和 $q:\id b b'$ 以及 $f:\hom_A(a,b)$，我们有
\begin{equation}\label{ct:idtoisocompute}
\id{\trans{(p,q)}{f}}
{\idtoiso(q)\circ f \circ \inv{\idtoiso(p)}}。
\end{equation}
\end{lem}
\begin{proof}
  通过归纳法，我们可以假设 $p$ 和 $q$ 分别是 $\refl a$ 和 $\refl b$。
  在这种情况下，\eqref{ct:idtoisocompute} 的左边简化为 $f$。
  但根据定义，$\idtoiso(\refl a)$ 是 $1_a$，$\idtoiso(\refl b)$ 是 $1_b$，因此 \eqref{ct:idtoisocompute} 的右边为 $1_b\circ f\circ 1_a$，这等于 $f$。
\end{proof}

类似地，我们可以证明
\begin{gather}
  \id{\idtoiso(\rev p)}{\inv {(\idtoiso(p))}}\\
  \id{\idtoiso(p\ct q)}{\idtoiso(q)\circ \idtoiso(p)}\\
  \id{\isotoid(f\circ e)}{\isotoid(e)\ct \isotoid(f)}
\end{gather}
等等。

\begin{eg}\label{ct:orders}
一个预范畴，其中每个集合 $\hom_A(a,b)$ 是单命题等价于一个类型 $A_0$，配有一个反身 ($a\le a$) 和传递 ($a\le b$ 且 $b\le c$，则 $a\le c$) 的单命题关系“$\le$”。
我们称这种结构为\define{预序 (preorder)}。\indexdef{预序 (preorder)}

在预序中，证据 $f: a\le b$ 是一个同构当且仅当存在某种证据 $g: b\le a$。
因此，$a\cong b$ 是单命题，即 $a\le b$ 且 $b\le a$。
因此，一个预序 $A$ 是范畴当且仅当 (1) 每个类型 $a=b$ 是单命题，(2) 对于任何 $a,b:A_0$ 存在一个函数 $(a\cong b) \to (a=b)$。
换句话说，$A_0$ 必须是一个集合，且 $\le$ 必须是反对称的\index{关系!反对称 (relation!antisymmetric)}（如果 $a\le b$ 且 $b\le a$，则 $a=b$）。
我们称这种结构为\define{(偏序) (partial) order} 或\define{偏序集 (poset)}。\indexdef{偏序 (partial order)}%
\indexdef{偏序集 (poset)}%
\end{eg}

\begin{eg}\label{ct:gaunt}
如果 $A$ 是一个范畴，那么 $A_0$ 是一个集合当且仅当对于任意 $a,b:A_0$，类型 $a\cong b$ 是单命题。
给定 $A$ 是一个范畴，这等价于说每个自同构在 $A$ 中都是恒等箭头。另一方面，如果 $A$ 是一个预范畴且 $A_0$ 是一个集合，那么 $A$ 是范畴当且仅当它是骨架 (skeletal)\index{数学!经典 (mathematics!classical)}（任何两个同构的对象是相等的）\emph{并且}每个自同构是恒等箭头。
这种类型的范畴有时被称为\define{gaunt} 范畴~\cite{bsp12infncats}。\indexdef{范畴!gaunt (category!gaunt)}%
\indexdef{gaunt 范畴 (gaunt category)}%
\index{骨架范畴 (skeletal category)}%
\index{范畴!骨架 (category!skeletal)}%
对于我们的范畴，没有真正的“骨架性”概念，除非认为 \cref{ct:category} 本身是这样的。
\end{eg}

\begin{eg}\label{ct:discrete}
对于任意 1-类型 $X$，存在一个范畴，其对象类型为 $X$，且 $\hom(x,y) \defeq (x=y)$。
如果 $X$ 是一个集合，我们称其为\define{离散范畴 (discrete category)}。\indexdef{范畴!离散 (category!discrete)}%
\indexdef{离散!范畴 (discrete!category)}%
通常我们称其为\define{群组 (groupoid)}（见 \cref{ct:groupoids}）。
\end{eg}

\begin{eg}\label{ct:fundgpd}
对于\emph{任意}类型 $X$，存在一个预范畴，其对象类型为 $X$，且 $\hom(x,y) \defeq \pizero{x=y}$。
复合运算
\[ \pizero{y=z} \to \pizero{x=y} \to \pizero{x=z} \]
通过同伦连接从复合 $(y=z)\to(x=y)\to(x=z)$ 归纳定义。
我们称其为 $X$ 的\define{基本预群组 (fundamental pregroupoid)}。\indexdef{基本!预群组 (fundamental!pregroupoid)}%
\indexsee{预群组，基本 (pregroupoid, fundamental)}{基本预群组 (fundamental pregroupoid)}%
（实际上，我们在 \cref{sec:van-kampen} 中已经遇到了它；另见 \cref{ex:rezk-vankampen}。）
\end{eg}

\begin{eg}\label{ct:hoprecat}
存在一个预范畴，其对象类型是 \type，且 $\hom(X,Y) \defeq \pizero{X\to Y}$，复合通过同伦连接从普通复合 $(Y\to Z) \to (X\to Y) \to (X\to Z)$ 归纳定义。
我们称其为\define{类型的同伦预范畴 (homotopy precategory of types)}。\indexdef{类型的预范畴 (precategory!of types)}%
\index{同伦!类型范畴 (homotopy!category of types)}%
\end{eg}

\begin{eg}\label{ct:rel}
令 \urel 为以下预范畴：
\begin{itemize}
  \item 其对象是集合。
  \item $\hom_{\urel}(X,Y) = X\to Y\to \prop$。
  \item 对于集合 $X$，我们有 $1_X(x,x') \defeq (x=x')$。
  \item 对于 $R:\hom_{\urel}(X,Y)$ 和 $S:\hom_{\urel}(Y,Z)$，它们的复合定义为
  \[ (S\circ R)(x,z) \defeq \Brck{\sm{y:Y} R(x,y) \times S(y,z)}。\]
\end{itemize}
假设 $R:\hom_{\urel}(X,Y)$ 是一个同构，其逆为 $S$。
我们观察到以下几点。
\begin{enumerate}
  \item 如果 $R(x,y)$ 且 $S(y',x)$，则 $(R\circ S)(y',y)$，从而 $y'=y$。
  类似地，如果 $R(x,y)$ 且 $S(y,x')$，则 $x=x'$。\label{item:rel1}
  \item 对于任意 $x$，我们有 $x=x$，因此 $(S\circ R)(x,x)$。
  因此，仅存在某个 $y:Y$ 使得 $R(x,y)$ 且 $S(y,x)$。\label{item:rel2}
  \item 假设 $R(x,y)$。
  根据~\ref{item:rel2}，仅存在某个 $y'$ 使得 $R(x,y')$ 且 $S(y',x)$。
  但随后根据~\ref{item:rel1}，仅 $y'=y$，因此由于 $Y$ 是集合，所以 $y'=y$。
  因此，通过沿此等同性传递 $S(y',x)$，我们有 $S(y,x)$。
  结论是 $R(x,y)\to S(y,x)$。
  类似地，$S(y,x) \to R(x,y)$。\label{item:rel3}
  \item 如果 $R(x,y)$ 且 $R(x,y')$，则根据~\ref{item:rel3}，$S(y',x)$，因此根据~\ref{item:rel1}，$y=y'$。
  因此，对于任意 $x$，至多存在一个 $y$ 使得 $R(x,y)$。
  根据~\ref{item:rel2}，仅存在这样的 $y$，因此存在这样的 $y$。
\end{enumerate}
结论是，如果 $R:\hom_{\urel}(X,Y)$ 是同构，则对于每个 $x:X$，存在且仅存在一个 $y:Y$ 使得 $R(x,y)$，反之亦然。
因此，存在一个函数 $f:X\to Y$，将每个 $x$ 映射到此 $y$，该函数是等价的；因此 $X=Y$。
经过更多的推导，我们可以得出 \urel 是一个范畴。
\end{eg}

我们现在可能将自己限制为仅考虑范畴而非预范畴。
相反，我们将对预范畴和范畴进行许多概念的开发，以强调范畴相比于预范畴以及经典\index{数学!经典 (mathematics!classical)}数学中的普通范畴如何更加良好。

我们还将在 \crefrange{sec:strict-categories}{sec:dagger-categories} 中看到，在稍微异质的背景下，某些类型的预范畴除了范畴之外还有其他用途，每种预范畴以不同的方式“修复”对象的等同性。
这进一步强调了预范畴的“预”性：它们是从中可以定义多种重要范畴结构的原材料。
\section{函子与变换 (Functors and transformations)}
\label{sec:transfors}

以下定义非常明显，无需修改。

\begin{defn}\label{ct:functor}
设 $A$ 和 $B$ 是前范畴 (precategories)。
一个\define{函子 (functor)} $F:A\to B$ 由以下部分组成：
\begin{enumerate}
  \item 一个函数 $F_0:A_0\to B_0$，通常也记作 $F$。
  \item 对每个 $a,b:A$，一个函数 $F_{a,b}:\hom_A(a,b) \to \hom_B(Fa,Fb)$，通常也记作 $F$。
  \item 对每个 $a:A$，我们有 $\id{F(1_a)}{1_{Fa}}$。
  \item 对每个 $a,b,c:A$ 以及 $f:\hom_A(a,b)$ 和 $g:\hom_A(b,c)$，我们有
  \[\id{F(g\circ f)}{Fg\circ Ff}。\]\label{ct:functor:comp}
\end{enumerate}
\end{defn}

注意，通过同一性归纳 (induction on identity)，函子还保持 $\idtoiso$。

\begin{defn}\label{ct:nattrans}
对于函子 $F,G:A\to B$，一个\define{自然变换 (natural transformation)} $\gamma:F\to G$ 由以下部分组成：
\begin{enumerate}
  \item 对每个 $a:A$，一个态射 $\gamma_a:\hom_B(Fa,Ga)$ (称为“分量”)。
  \item 对每个 $a,b:A$ 和 $f:\hom_A(a,b)$，我们有 $\id{Gf\circ \gamma_a}{\gamma_b\circ Ff}$ (称为“自然性公理”)。
\end{enumerate}
\end{defn}

由于每个类型 $\hom_B(Fa,Gb)$ 是一个集合，因此它的同一性类型 (identity type) 是一个纯命题 (mere proposition)。
因此，自然性公理是一个纯命题，所以自然变换的同一性由它们的分量的同一性决定。
特别地，对于任意 $F$ 和 $G$，从 $F$ 到 $G$ 的自然变换的类型也是一个集合。

同样，函子的同一性由函数 $A_0\to B_0$ 的同一性（以及在此基础上运输的同源集合上的相应函数）决定。

\begin{defn}\label{ct:functor-precat}
对于前范畴 $A,B$，存在一个称为\define{函子前范畴 (functor precategory)} 的前范畴 $B^A$，其定义如下：
\begin{itemize}
  \item $(B^A)_0$ 是从 $A$ 到 $B$ 的函子的类型。
  \item $\hom_{B^A}(F,G)$ 是从 $F$ 到 $G$ 的自然变换的类型。
\end{itemize}
\end{defn}
\begin{proof}
  我们定义 $(1_F)_a\defeq 1_{Fa}$。
  自然性遵循前范畴的单位公理。
  对于 $\gamma:F\to G$ 和 $\delta:G\to H$，我们定义 $(\delta\circ\gamma)_a\defeq \delta_a\circ \gamma_a$。
  自然性遵循结合性。
  同样，$B^A$ 的单位和结合性公理也遵循 $B$ 的单位和结合性公理。
\end{proof}

\begin{lem}\label{ct:natiso}
一个自然变换 $\gamma:F\to G$ 如果且仅如果每个 $\gamma_a$ 在 $B$ 中是一个同构，那么它在 $B^A$ 中是一个同构。
\end{lem}
\begin{proof}
  如果 $\gamma$ 是一个同构，那么我们有 $\delta:G\to F$ 作为它的逆变换。
  根据在 $B^A$ 中的合成定义，$(\delta\gamma)_a\jdeq \delta_a\gamma_a$，同样地 $(\gamma\delta)_a\jdeq \gamma_a\delta_a$。
  因此，$\id{\delta\gamma}{1_F}$ 和 $\id{\gamma\delta}{1_G}$ 意味着 $\id{\delta_a\gamma_a}{1_{Fa}}$ 和 $\id{\gamma_a\delta_a}{1_{Ga}}$，因此 $\gamma_a$ 是一个同构。

  反过来，假设每个 $\gamma_a$ 是一个同构，设它的逆为 $\delta_a$。
  我们定义一个自然变换 $\delta:G\to F$，其分量为 $\delta_a$；对于自然性公理，我们有
  \[ Ff\circ \delta_a = \delta_b\circ \gamma_b\circ Ff \circ \delta_a = \delta_b\circ Gf\circ \gamma_a\circ \delta_a = \delta_b\circ Gf. \]
  现在，由于自然变换的合成和同一性是由它们的分量决定的，我们有 $\id{\gamma\delta}{1_G}$ 和 $\id{\delta\gamma}{1_F}$。
\end{proof}

以下结果是基础性的。

\begin{thm}\label{ct:functor-cat}
如果 $A$ 是一个前范畴而 $B$ 是一个范畴 (category)，那么 $B^A$ 是一个范畴。
\end{thm}
\begin{proof}
  令 $F,G:A\to B$；我们必须证明 $\idtoiso:(\id{F}{G}) \to (F\cong G)$ 是一个等价。

  为了给它一个逆，我们假设 $\gamma:F\cong G$ 是一个自然同构。
  然后对于任意 $a:A$，我们有一个同构 $\gamma_a:Fa \cong Ga$，因此一个同一性 $\isotoid(\gamma_a):\id{Fa}{Ga}$。
  通过函数扩展性 (function extensionality)，我们有一个同一性 $\bar{\gamma}:\id[(A_0\to B_0)]{F_0}{G_0}$。

  现在，由于函子的最后两个公理是纯命题，为了证明 $\id{F}{G}$，我们只需证明对于任意 $a,b:A$，函数
  \begin{align*}
    F_{a,b}&:\hom_A(a,b) \to \hom_B(Fa,Fb)\mathrlap{\qquad\text{和}}\\
    G_{a,b}&:\hom_A(a,b) \to \hom_B(Ga,Gb)
  \end{align*}
  在沿着 $\bar\gamma$ 运输时变得相等。
  通过函数扩展性的计算，当应用于 $a$ 时，$\bar\gamma$ 变得等于 $\isotoid(\gamma_a)$。
  但通过 \cref{ct:idtoiso-trans}，沿 $\isotoid(\gamma_a)$ 和 $\isotoid(\gamma_b)$ 运输 $Ff:\hom_B(Fa,Fb)$ 等于复合 $\gamma_b\circ Ff\circ \inv{(\gamma_a)}$，这通过 $\gamma$ 的自然性等于 $Gf$。

  这完成了从 $(F\cong G) \to (\id F G)$ 的函数的定义。
  现在考虑复合
  \[ (\id F G) \to (F\cong G) \to (\id F G). \]
  由于同源集 (hom-sets) 是集合，它们的同一性类型是纯命题，因此为了证明两个同一性 $p,q:\id F G$ 是相等的，只需证明 $\id[\id{F_0}{G_0}]{p}{q}$。
  但在 $\bar\gamma$ 的定义中，如果 $\gamma$ 是 $\idtoiso(p)$ 的形式，那么 $\gamma_a$ 将等于 $\idtoiso(p_a)$（这可以通过对 $p$ 归纳轻松证明）。
  因此，$\isotoid(\gamma_a)$ 将等于 $p_a$，所以通过函数扩展性，我们将有 $\id{\bar\gamma}{p}$，这正是我们需要的。

  最后，考虑复合
  \[(F\cong G)\to  (\id F G) \to (F\cong G). \]
  由于自然变换的同一性可以通过分量来测试，只需证明对于每个 $a$，我们有 $\id{\idtoiso(\bar\gamma)_a}{\gamma_a}$。
  但如上所述，我们有 $\id{\idtoiso(\bar\gamma)_a}{\idtoiso((\bar\gamma)_a)}$，而 $\id{(\bar\gamma)_a}{\isotoid(\gamma_a)}$ 通过函数扩展性计算得到。
  由于 $\isotoid$ 和 $\idtoiso$ 是逆函数，我们有 $\id{\idtoiso(\bar\gamma)_a}{\gamma_a}$，如所希望的那样。
\end{proof}

特别地，范畴（相对于前范畴）之间的自然同构函子是相等的。

\mentalpause

我们现在定义所有常见的函子和自然变换的合成方式。

\begin{defn}\label{ct:functor-composition}
对于函子 $F:A\to B$ 和 $G:B\to C$，它们的复合 $G\circ F:A\to C$ 定义如下：
\begin{itemize}
  \item 复合 $(G_0\circ F_0) : A_0 \to C_0$
  \item 对每个 $a,b:A$，复合
  \[(G_{Fa,Fb}\circ F_{a,b}):\hom_A(a,b) \to \hom_C(GFa,GFb)。\]
\end{itemize}
公理很容易验证。
\end{defn}

\begin{defn}\label{ct:whisker}
对于函子 $F:A\to B$ 和 $G,H:B\to C$ 以及自然变换 $\gamma:G\to H$，复合 $(\gamma F):GF\to HF$ 定义如下：
\begin{itemize}
  \item 对每个 $a:A$，分量为 $\gamma_{Fa}$。
\end{itemize}
自然性很容易验证。
同样，对于上述的 $\gamma$ 和 $K:C\to D$，复合 $(K\gamma):KG\to KH$ 定义如下：
\begin{itemize}
  \item 对每个 $b:B$，分量为 $K(\gamma_b)$。
\end{itemize}
\end{defn}

\begin{lem}\label{ct:interchange}
对于函子 $F,G:A\to B$ 和 $H,K:B\to C$ 以及自然变换 $\gamma:F\to G$ 和 $\delta:H\to K$，我们有
\[\id{(\delta G)(H\gamma)}{(K\gamma)(\delta F)}。\]
\end{lem}
\begin{proof}
  分量检查足够了：在 $a:A$ 处我们有
  \begin{align*}
    ((\delta G)(H\gamma))_a
    &\jdeq (\delta G)_{a}(H\gamma)_a\\
    &\jdeq \delta_{Ga}\circ H(\gamma_a)\\
    &= K(\gamma_a) \circ \delta_{Fa} \tag{通过 $\delta$ 的自然性}\\
    &\jdeq (K \gamma)_a\circ (\delta F)_a\\
    &\jdeq ((K \gamma)(\delta F))_a。\qedhere
  \end{align*}
\end{proof}

\index{水平合成!自然变换的 (horizontal composition of natural transformations)}%
\index{经典!范畴论 (classical category theory)}%
在经典的范畴论中，通常定义 $\gamma:F\to G$ 和 $\delta:H\to K$ 的“水平合成 (horizontal composite)”为 ${(\delta G)(H\gamma)}$ 和 ${(\gamma\delta)(\delta F)}$ 的公共值。
我们将避免这样做，因为虽然它们相等，但这两个变换并不是\emph{定义上}相等的。
这也带来了这样的结果，即我们可以明确地使用符号 $\circ$（或并列）进行所有种类的合成：只有一种方式可以合成两个自然变换（而不是在任一侧将自然变换与函子合成）。

\begin{lem}\label{ct:functor-assoc}
函子合成是结合的：$\id{H(GF)}{(HG)F}$。
\end{lem}
\begin{proof}
  由于函数的合成是结合的，这在作用于对象和同态时立刻就可以得到。
  由于同源集是集合，其余的数据是自动的。
\end{proof}

\cref{ct:functor-assoc} 中的等式同样不是定义上的。
（函数合成是定义上的结合，但进入函子的公理也必须合成，这打破了定义上的结合性。）因此，我们还需要知道关于结合性的\emph{一致性 (coherence)}。

\begin{lem}\label{ct:pentagon}
\cref{ct:functor-assoc} 是一致的，即以下五边形 (pentagon) 的等式是可交换的：
\[ \xymatrix{ & K(H(GF)) \ar@{=}[dl] \ar@{=}[dr]\\
(KH)(GF) \ar@{=}[d] && K((HG)F) \ar@{=}[d]\\
  ((KH)G)F && (K(HG))F \ar@{=}[ll].}
\]
\end{lem}
\begin{proof}
  正如在 \cref{ct:functor-assoc} 中一样，这在作用于对象时是显而易见的，其余的是自动的。
\end{proof}

我们将从此滥用符号，通过书写 $H\circ G\circ F$ 或 $HGF$ 来表示 $H(GF)$ 或 $(HG)F$，在必要时沿 \cref{ct:functor-assoc} 运输。
对于单位我们也有类似的一致性结果。

\begin{lem}\label{ct:units}
对于函子 $F:A\to B$，我们有等式 $\id{(1_B\circ F)}{F}$ 和 $\id{(F\circ 1_A)}{F}$，并且给定 $G:B\to C$ 时，以下三角形的等式是可交换的：
\[ \xymatrix{
  G\circ (1_B \circ F) \ar@{=}[rr] \ar@{=}[dr] &&
  (G\circ 1_B)\circ F \ar@{=}[dl] \\
  & G \circ F.}
\]
\end{lem}

请参阅 \cref{ct:pre2cat,ct:2cat} 以进一步发展这些思想。


\section{伴随 (Adjunctions)}
\label{sec:adjunctions}

伴随函子的定义是直接的；主要的有趣方面来源于证明相关性。

\begin{defn}\label{ct:adjoints}
一个函子 $F:A\to B$ 是一个\define{左伴随 (left adjoint)}，如果存在
\begin{itemize}
  \item 一个函子 $G:B\to A$。
  \item 一个自然变换 $\eta:1_A \to GF$ (称为\define{单元 (unit)}）。
  \item 一个自然变换 $\epsilon:FG\to 1_B$ (称为\define{余单元 (counit)}）。
  \item $\id{(\epsilon F)(F\eta)}{1_F}$。
  \item $\id{(G\epsilon)(\eta G)}{1_G}$。
\end{itemize}
\end{defn}

最后两个等式称为\define{三角等式 (triangle identities)} 或\define{锯齿等式 (zigzag identities)}。
我们将留给读者定义右伴随 (right adjoints) 的类似定义。

\begin{lem}\label{ct:adjprop}
如果 $A$ 是一个范畴（但 $B$ 可能只是一个前范畴），那么类型“$F$ 是一个左伴随”是一个纯命题。
\end{lem}
\begin{proof}
  假设我们给定 $(G,\eta,\epsilon)$ 以及三角等式，并且也有 $(G',\eta',\epsilon')$。
  定义 $\gamma:G\to G'$ 为 $(G'\epsilon)(\eta' G)$，并且定义 $\delta:G'\to G$ 为 $(G\epsilon')(\eta G')$。
  那么
  \begin{align*}
    \delta\gamma &=
    (G\epsilon')(\eta G')(G'\epsilon)(\eta'G)\\
    &= (G\epsilon')(G F G'\epsilon)(\eta G' F G)(\eta'G)\\
    &= (G\epsilon)(G\epsilon'FG)(G F \eta' G)(\eta G)\\
    &= (G\epsilon)(\eta G)\\
    &= 1_G
  \end{align*}
  使用 \cref{ct:interchange} 和三角等式。
  类似地，我们证明 $\id{\gamma\delta}{1_{G'}}$，因此 $\gamma$ 是一个自然同构 $G\cong G'$。
  通过 \cref{ct:functor-cat}，我们有一个同一性 $\id G {G'}$。

  现在我们需要知道当 $\eta$ 和 $\epsilon$ 沿此同一性运输时，它们变得等于 $\eta'$ 和 $\epsilon'$。
  通过 \cref{ct:idtoiso-trans}，此运输通过与 $\gamma$ 或 $\delta$ 适当地复合来给出。
  对于 $\eta$，这产生了
  \begin{equation*}
  (G'\epsilon F)(\eta'GF)\eta
  = (G'\epsilon F)(G'F\eta)\eta'
  = \eta'
  \end{equation*}
  使用 \cref{ct:interchange} 和三角等式。
  对于 $\epsilon$ 的情况是类似的。
  最后，三角等式自动正确地运输，因为同源集是集合。
\end{proof}

在 \cref{sec:yoneda} 中我们将给出 \cref{ct:adjprop} 的另一个证明。

\section{等价 (Equivalences)}
\label{sec:equivalences}

在范畴论 (category theory) 中，通常将\emph{范畴的等价 (equivalence of categories)}定义为一个函子 $F:A\to B$，使得存在一个函子 $G:B\to A$ 以及自然同构 $F G \cong 1_B$ 和 $G F \cong 1_A$。
然而，与作为伴随 (adjunction) 的性质不同，如果不进行截断，这将不是一个纯命题，原因与拟逆元 (quasi-inverses) 的类型行为不良相同（参见 \cref{sec:quasi-inverses}）。
如同在 \cref{sec:hae} 中那样，我们可以通过使用通常的\emph{伴随等价 (adjoint equivalence)}的概念来避免这个问题。
\indexdef{伴随!等价 (adjoint equivalence)!范畴 (precategories)}

\begin{defn}\label{ct:equiv}
一个函子 $F:A\to B$ 是一个\define{范畴的等价 (equivalence of (pre)categories)}，
\indexdef{等价!范畴的 (equivalence of (pre)categories)}%
\indexdef{范畴!等价 (category equivalence)}%
\indexdef{前范畴!等价 (precategory equivalence)}%
\index{函子!等价 (functor equivalence)}%
如果它是一个左伴随，并且其 $\eta$ 和 $\epsilon$ 是同构。
我们记 $\cteqv A B$ 为从 $A$ 到 $B$ 的范畴等价的类型。
\end{defn}

根据 \cref{ct:adjprop,ct:isoprop}，如果 $A$ 是一个范畴，那么“$F$ 是前范畴的等价”这个类型是一个纯命题。

\begin{lem}\label{ct:adjointification}
如果对于 $F:A\to B$ 存在 $G:B\to A$ 和同构 $GF\cong 1_A$ 和 $FG\cong 1_B$，那么 $F$ 是前范畴的等价。
\end{lem}
\begin{proof}
  类似于 \cref{thm:equiv-iso-adj} 中关于类型等价的证明。
\end{proof}

\begin{defn}\label{ct:full-faithful}
我们说一个函子 $F:A\to B$ 是\define{忠实的 (faithful)}，
\indexdef{函子!忠实 (faithful)}%
\index{忠实函子 (faithful functor)}%
如果对于所有 $a,b:A$，函数
\[F_{a,b}:\hom_A(a,b) \to \hom_B(Fa,Fb)\]
是单射 (injective) 的，并且\define{满的 (full)}，
\indexdef{函子!满 (full)}%
\indexdef{满函子 (full functor)}%
如果对于所有 $a,b:A$ 这个函数是满射 (surjective) 的。
如果它同时是两者（因此每个 $F_{a,b}$ 是一个等价），我们说 $F$ 是\define{完全忠实的 (fully faithful)}。
\indexdef{函子!完全忠实 (fully faithful)}%
\indexdef{完全忠实函子 (fully faithful functor)}%
\end{defn}

\begin{defn}\label{ct:split-essentially-surjective}
我们说一个函子 $F:A\to B$ 是\define{分裂本质满射的 (split essentially surjective)}，
\indexdef{函子!分裂本质满射 (split essentially surjective)}%
\indexdef{分裂!本质满射函子 (split essentially surjective functor)}%
如果对于所有 $b:B$，存在一个 $a:A$，使得 $Fa\cong b$。
\end{defn}

\begin{lem}\label{ct:ffeso}
对于任意前范畴 $A$ 和 $B$ 以及函子 $F:A\to B$，以下类型是等价的。
\begin{enumerate}
  \item $F$ 是前范畴的等价。\label{item:ct:ffeso1}
  \item $F$ 是完全忠实并且分裂本质满射的。\label{item:ct:ffeso2}
\end{enumerate}
\end{lem}
\begin{proof}
  假设 $F$ 是前范畴的等价，并指定了 $G,\eta,\epsilon$。
  那么我们有函数
  \begin{align*}
    \hom_B(Fa,Fb) &\to \hom_A(a,b),\\
    g &\mapsto \inv{\eta_b}\circ G(g)\circ \eta_a。
  \end{align*}
  对于 $f:\hom_A(a,b)$，我们有
  \[ \inv{\eta_{b}}\circ G(F(f))\circ \eta_{a}  =
  \inv{\eta_{b}} \circ \eta_{b} \circ f=
  f
  \]
  而对于 $g:\hom_B(Fa,Fb)$，我们有
  \begin{align*}
    F(\inv{\eta_b} \circ G(g)\circ\eta_a)
    &= F(\inv{\eta_b})\circ F(G(g))\circ F(\eta_a)\\
    &= \epsilon_{Fb}\circ F(G(g))\circ F(\eta_a)\\
    &= g\circ\epsilon_{Fa}\circ F(\eta_a)\\
    &= g
  \end{align*}
  使用 $\epsilon$ 的自然性 (naturality)，以及三角等式两次。
  因此，$F_{a,b}$ 是一个等价，因此 $F$ 是完全忠实的。
  最后，对于任意 $b:B$，我们有 $Gb:A$ 和 $\epsilon_b:FGb\cong b$。

  另一方面，假设 $F$ 是完全忠实并且分裂本质满射的。
  定义 $G_0:B_0\to A_0$ 通过将 $b:B$ 发送到指定的本质分裂给出的 $a:A$，并写 $\epsilon_b$ 为同样指定的同构 $FGb\cong b$。

  现在对于任意 $g:\hom_B(b,b')$，定义 $G(g):\hom_A(Gb,Gb')$ 为唯一的态射，使得 $\id{F(G(g))}{\inv{(\epsilon_{b'})}\circ g \circ \epsilon_b }$（由于 $F$ 是完全忠实的，该态射存在）。
  最后，对于 $a:A$ 定义 $\eta_a:\hom_A(a,GFa)$ 为唯一的态射，使得 $\id{F\eta_a}{\inv{\epsilon_{Fa}}}$。
  很容易验证 $G$ 是一个函子，并且 $(G,\eta,\epsilon)$ 展示了 $F$ 作为一个前范畴的等价。

  现在考虑复合~\ref{item:ct:ffeso1}$\to$\ref{item:ct:ffeso2}$\to$\ref{item:ct:ffeso1}。
  我们显然恢复了相同的函数 $G_0:B_0 \to A_0$。
  对于同态集上的 $G$ 的作用，我们必须证明对于 $g:\hom_B(b,b')$，$G(g)$ 是（必然唯一的）态射，使得 $F(G(g)) = \inv{(\epsilon_{b'})}\circ g \circ \epsilon_b$。
  但这个方程通过假设的 $\epsilon$ 的自然性成立。
  我们同样显然恢复了 $\epsilon$，而 $\eta$ 是通过 $\id{F\eta_a}{\inv{\epsilon_{Fa}}}$（这是伴随等价结构中假定的三角等式之一）唯一确定的。
  因此，这个复合等于恒等式。

  最后，考虑另一个复合~\ref{item:ct:ffeso2}$\to$\ref{item:ct:ffeso1}$\to$\ref{item:ct:ffeso2}。
  由于完全忠实是一个纯命题，足以观察到我们为每个 $b:B$ 恢复了相同的 $a:A$ 和同构 $F a \cong b$。
  但这是显然的，因为我们使用了这个函数和同构来定义 $G_0$ 和 $\epsilon$ 在~\ref{item:ct:ffeso1} 中，这反过来又正是我们用来再次恢复~\ref{item:ct:ffeso2} 的内容。
  因此，两个方向上的复合都等于恒等式，因此我们有一个等价 $\eqv{\text{\ref{item:ct:ffeso1}}}{\text{\ref{item:ct:ffeso2}}}$。
\end{proof}

然而，如果 $A$ 不是一个范畴，那么 \cref{ct:ffeso} 中的任意类型可能不一定是一个纯命题。
这提示我们也考虑以下概念。

\begin{defn}\label{ct:essentially-surjective}
一个函子 $F:A\to B$ 是\define{本质满射 (essentially surjective)}的，
\indexdef{函子!本质满射 (essentially surjective)}%
\indexdef{本质满射函子 (essentially surjective functor)}%
如果对于所有 $b:B$，\emph{仅仅}存在一个 $a:A$ 使得 $Fa\cong b$。
我们说 $F$ 是一个\define{弱等价 (weak equivalence)}，
\indexsee{等价!弱等价 (weak equivalence)的 (equivalence of (pre)categories)}{weak equivalence}%
\indexdef{弱等价!前范畴 (weak equivalence of precategories)}%
\indexsee{函子!弱等价 (weak equivalence)的 (functor weak equivalence)}{weak equivalence}%
如果它是完全忠实并且本质满射的。
\end{defn}

作为一个弱等价始终是一个纯命题。
然而，对于范畴之间的函子，等价与弱等价没有区别。

\index{接受度 (acceptance)}
\begin{lem}\label{ct:catweq}
如果 $F:A\to B$ 是完全忠实的并且 $A$ 是一个范畴，那么对于任何 $b:B$ 类型 $\sm{a:A} (Fa\cong b)$ 是一个纯命题。
因此，一个范畴之间的函子如果且仅如果它是一个弱等价，则是一个等价。
\end{lem}
\begin{proof}
  假设给定 $(a,f)$ 和 $(a',f')$ 在 $\sm{a:A} (Fa\cong b)$ 中。
  然后 $\inv{f'}\circ f$ 是一个同构 $Fa \cong Fa'$。
  由于 $F$ 是完全忠实的，我们有 $g:a\cong a'$，其中 $Fg = \inv{f'}\circ f$。
  由于 $A$ 是一个范畴，我们有 $p:a=a'$，其中 $\idtoiso(p)=g$。
  现在 $Fg = \inv{f'}\circ f$ 意味着 $\trans{(\map{(F_0)}{p})}{f} = f'$，因此（根据依赖对类型中相等性的特征）$(a,f)=(a',f')$。

  因此，对于域为范畴的完全忠实函子，本质满射等价于分裂本质满射，因此，弱等价等价于等价。
\end{proof}

这是我们范畴论相对于基于集合的方法的一个重要优势。
在一个纯集合论定义的范畴中，“每个完全忠实并且本质满射的函子都是一个范畴等价”这一命题等价于选择公理 \choice{}。
在这里，我们免费获得了它，作为选择唯一性原则 (principle of unique choice) 的范畴论版本 (\cref{sec:unique-choice})。
（实际上，这个性质刻画了前范畴中的范畴；参见 \cref{sec:rezk}。）

另一方面，以下对范畴等价的刻画可能更有用。

\begin{defn}\label{ct:isocat}
一个函子 $F:A\to B$ 是一个\define{范畴的同构 (isomorphism of (pre)categories)}，
\indexdef{同构!范畴的 (isomorphism of (pre)categories)}%
\indexdef{范畴!同构 (category isomorphism)}%
\indexdef{前范畴!同构 (precategory isomorphism)}%
如果 $F$ 是完全忠实的并且 $F_0:A_0\to B_0$ 是一个类型等价。
\end{defn}

这个定义是我们的一般规则的一个例外（参见 \cref{sec:basics-equivalences}），即只在集合和类集合样的对象上使用“同构”一词。
然而，在这里它确实带有适当的含义，因为对于一般的前范畴，同构比等价更强。

注意，作为前范畴的同构始终是一个纯命题。
我们记 $A\cong B$ 为从 $A$ 到 $B$ 的前范畴同构的类型。

\begin{lem}\label{ct:isoprecat}
对于前范畴 $A$ 和 $B$ 以及函子 $F:A\to B$，以下命题是等价的。
\begin{enumerate}
  \item $F$ 是前范畴的同构。\label{item:ct:ipc1}
  \item 存在 $G:B\to A$ 和 $\eta:1_A = GF$ 以及 $\epsilon:FG=1_B$，使得\label{item:ct:ipc2}
  \begin{equation}
    \apfunc{(\lam{H} F H)}({\eta}) = \apfunc{(\lam{K} K F)}({\opp\epsilon})。\label{eq:ct:isoprecattri}
  \end{equation}
  \item 仅仅存在 $G:B\to A$ 和 $\eta:1_A = GF$ 以及 $\epsilon:FG=1_B$。\label{item:ct:ipc3}
\end{enumerate}
\end{lem}

注意，如果 $B_0$ 不是一个 1-类型，那么~\eqref{eq:ct:isoprecattri} 可能不是一个纯命题。

\begin{proof}
  首先注意，由于同源集是集合，函子之间相等性的相等由其对象部分唯一确定。
  因此，根据函数外延性 (function extensionality)，~\eqref{eq:ct:isoprecattri} 等价于
  \begin{equation}
    \map{(F_0)}{\eta_0}_a = \opp{(\epsilon_0)}_{F_0 a}。\label{eq:ct:ipctri}
  \end{equation}
  对于所有 $a:A_0$。
  注意这正是 $G_0$，$\eta_0$ 和 $\epsilon_0$ 作为证明 $F_0$ 是一个半伴随等价 (half adjoint equivalence) 的三角等式。

  现在假设~\ref{item:ct:ipc1}。
  令 $G_0:B_0 \to A_0$ 为 $F_0$ 的逆元，具有 $\eta_0: \idfunc[A_0] = G_0 F_0$ 和 $\epsilon_0:F_0G_0 = \idfunc[B_0]$ 满足三角等式，这正是~\eqref{eq:ct:ipctri}。
  现在定义 $G_{b,b'}:\hom_B(b,b') \to \hom_A(G_0b,G_0b')$ 为
  \[ G_{b,b'}(g) \defeq
  \inv{(F_{G_0b,G_0b'})}\Big(\idtoiso(\opp{(\epsilon_0)}_{b'}) \circ g \circ \idtoiso((\epsilon_0)_b)\Big)
  \]
  （使用假设 $F$ 是完全忠实的）。
  由于 \idtoiso 取逆元到逆元，且复合到组合，并且 $F$ 是一个函子，因此 $G$ 是一个函子。

  按定义，我们有 $(GF)_0 \jdeq G_0 F_0$，通过 $\eta_0$ 等于 $\idfunc[A_0]$。
  为了获得 $1_A = GF$，我们需要证明当沿着 $\eta_0$ 运输时，同源集的恒等函数变得等于复合 $G_{Fa,Fa'} \circ F_{a,a'}$。
  换句话说，对于任意 $f:\hom_A(a,a')$，我们必须有
  \begin{multline*}
    \idtoiso((\eta_0)_{a'}) \circ f \circ \idtoiso(\opp{(\eta_0)}_a)\\
    = \inv{(F_{GFa,GFa'})}\Big(\idtoiso(\opp{(\epsilon_0)}_{Fa'})
    \circ F_{a,a'}(f) \circ \idtoiso((\epsilon_0)_{Fa})\Big)。
  \end{multline*}
  但这等价于
  \begin{multline*}
  (F_{GFa,GFa'})\Big(\idtoiso((\eta_0)_{a'}) \circ f \circ \idtoiso(\opp{(\eta_0)}_a)\Big)\\
  = \idtoiso(\opp{(\epsilon_0)}_{Fa'})
  \circ F_{a,a'}(f)
  \circ \idtoiso((\epsilon_0)_{Fa})。
  \end{multline*}
  这跟随于 $F$ 的函子性，$F$ 保持 \idtoiso 的事实，以及~\eqref{eq:ct:ipctri}。
  因此我们有 $\eta:1_A = GF$。

  另一方面，我们有 $(FG)_0\jdeq F_0 G_0$，通过 $\epsilon_0$ 等于 $\idfunc[B_0]$。
  为了获得 $FG=1_B$，我们需要证明当沿着 $\epsilon_0$ 运输时，同源集的恒等函数变得等于复合 $F_{Gb,Gb'} \circ G_{b,b'}$。
  也就是说，对于任意 $g:\hom_B(b,b')$，我们必须有
  \begin{multline*}
    F_{Gb,Gb'}\Big(\inv{(F_{Gb,Gb'})}\Big(\idtoiso(\opp{(\epsilon_0)}_{b'}) \circ g \circ \idtoiso((\epsilon_0)_b)\Big)\Big)\\
    = \idtoiso((\opp{\epsilon_0})_{b'}) \circ g \circ \idtoiso((\epsilon_0)_b)。
  \end{multline*}
  但这仅仅是 $\inv{(F_{Gb,Gb'})}$ 是 $F_{Gb,Gb'}$ 的逆元的事实。
  我们已经提到~\eqref{eq:ct:isoprecattri} 等价于~\eqref{eq:ct:ipctri}，所以~\ref{item:ct:ipc2} 成立。

  反过来，假设~\ref{item:ct:ipc2}；那么 $G$ 的对象部分，$\eta$ 和 $\epsilon$ 以及~\eqref{eq:ct:ipctri} 的对象部分表明 $F_0$ 是一个类型等价。
  而对于 $a,a':A_0$，我们定义 $\overline{G}_{a,a'}: \hom_B(Fa,Fa') \to \hom_A(a,a')$ 为
  \begin{equation}
    \overline{G}_{a,a'}(g) \defeq \idtoiso(\opp{\eta})_{a'} \circ G(g) \circ \idtoiso(\eta)_a。\label{eq:ct:gbar}
  \end{equation}
  根据 $\idtoiso(\eta)$ 的自然性，对于任意 $f:\hom_A(a,a')$，我们有
  \begin{align*}
    \overline{G}_{a,a'}(F_{a,a'}(f))
    &= \idtoiso(\opp{\eta})_{a'} \circ G(F(f)) \circ \idtoiso(\eta)_a\\
    &= \idtoiso(\opp{\eta})_{a'} \circ \idtoiso(\eta)_{a'} \circ f \\
    &= f。
  \end{align*}
  另一方面，对于 $g:\hom_B(Fa,Fa')$，我们有
  \begin{align*}
    F_{a,a'}(\overline{G}_{a,a'}(g))
    &= F(\idtoiso(\opp{\eta})_{a'}) \circ F(G(g)) \circ F(\idtoiso(\eta)_a)\\
    &= \idtoiso(\epsilon)_{Fa'}
    \circ F(G(g))
    \circ \idtoiso(\opp{\epsilon})_{Fa}\\
    &= \idtoiso(\epsilon)_{Fa'}
    \circ \idtoiso(\opp{\epsilon})_{Fa'}
    \circ g\\
    &= g。
  \end{align*}
  （这里需要一些关于 \idtoiso 和 whiskering 兼容性的引理，我们留给读者去陈述和证明。）
  因此，$F_{a,a'}$ 是一个等价，所以 $F$ 是完全忠实的；即~\ref{item:ct:ipc1} 成立。

  现在复合~\ref{item:ct:ipc1}$\to$\ref{item:ct:ipc2}$\to$\ref{item:ct:ipc1} 等于恒等式，因为~\ref{item:ct:ipc1} 是一个纯命题。
  另一方面，跟踪以上构造，我们看到复合~\ref{item:ct:ipc2}$\to$\ref{item:ct:ipc1}$\to$\ref{item:ct:ipc2} 本质上保留了 $G_0$，$\eta_0$，$\epsilon_0$ 的对象部分以及~\eqref{eq:ct:isoprecattri} 的对象部分。
  而在后面三种情况下，对象部分就是全部，因为同源集是集合。

  因此，足以证明我们恢复了 $G$ 在同源集上的作用。
  换句话说，我们必须证明如果 $g:\hom_B(b,b')$，那么
  \[ G_{b,b'}(g) =
  \overline{G}_{G_0b,G_0b'}\Big(\idtoiso(\opp{(\epsilon_0)}_{b'}) \circ g \circ \idtoiso((\epsilon_0)_b)\Big)
  \]
  其中 $\overline{G}$ 定义为~\eqref{eq:ct:gbar}。
  然而，这跟随于 $G$ 的函子性和\emph{另一}三角等式，我们在 \cref{cha:equivalences} 中看到这等价于~\eqref{eq:ct:ipctri}。

  现在，由于~\ref{item:ct:ipc1} 是一个纯命题，~\ref{item:ct:ipc2} 也是如此，所以足以证明它们逻辑上等价于~\ref{item:ct:ipc3}。
  当然，~\ref{item:ct:ipc2}$\to$\ref{item:ct:ipc3}，所以让我们假设~\ref{item:ct:ipc3}。
  由于~\ref{item:ct:ipc1} 是一个纯命题，我们可以假设给定 $G$，$\eta$ 和 $\epsilon$。
  然后 $G_0$ 连同 $\eta$ 和 $\epsilon$ 表明 $F_0$ 是一个等价。
  此外，我们还有自然同构 $\idtoiso(\eta):1_A\cong GF$ 和 $\idtoiso(\epsilon):FG\cong 1_B$，因此根据 \cref{ct:adjointification}，$F$ 是一个前范畴的等价，特别是完全忠实的。
\end{proof}

从 \cref{ct:isoprecat}\ref{item:ct:ipc2} 和函子范畴中的 $\idtoiso$，我们可以立即得出任何前范畴的同构都是等价的。
对于前范畴，反过来可能会失败。

\begin{eg}\label{ct:chaotic}
设 $X$ 是一个类型且 $x_0:X$ 是一个元素，并令 $X_{\mathrm{ch}}$ 表示 $X$ 上的\emph{混乱 (chaotic)}\indexdef{混乱前范畴 (chaotic precategory)}或\emph{不分离 (indiscrete)}\indexdef{不分离前范畴 (indiscrete precategory)}前范畴。
按照定义，我们有 $(X_{\mathrm{ch}})_0\defeq X$，并且对于所有 $x,x'$，$\hom_{X_{\mathrm{ch}}}(x,x') \defeq \unit$。
然后唯一的函子 $X_{\mathrm{ch}}\to \unit$ 是一个前范畴的等价，但除非 $X$ 是收缩的 (contractible)，否则它不是同构。

这个例子也表明，一个前范畴可以等价于一个范畴而不自身是一个范畴。
当然，如果一个前范畴\emph{是同构的}到一个范畴，那么它自身必须是一个范畴。
\end{eg}

然而，对于范畴，这两个概念是一致的。

\begin{lem}\label{ct:eqv-levelwise}
对于范畴 $A$ 和 $B$，一个函子 $F:A\to B$ 如果且仅如果它是范畴的同构，则是范畴的等价。
\end{lem}
\begin{proof}
  由于两者都是纯命题，所以足以证明它们逻辑上等价。
  因此，首先假设 $F$ 是范畴的等价，并给定了 $(G,\eta,\epsilon)$。
  我们已经看到 $F$ 是完全忠实的。
  根据 \cref{ct:functor-cat}，自然同构 $\eta$ 和 $\epsilon$ 产生了恒等式 $\id{1_A}{GF}$ 和 $\id{FG}{1_B}$，因此特别是 $\id{\idfunc[A]}{G_0\circ F_0}$ 和 $\id{F_0\circ G_0}{\idfunc[B]}$ 的恒等式。
  因此，$F_0$ 是一个类型等价。

  反过来，假设 $F$ 是完全忠实的并且 $F_0$ 是一个类型等价，假设其逆元是 $G_0$。
  那么对于每个 $b:B$，我们有 $G_0 b:A$ 并且有一个恒等式 $\id{FGb}{b}$，因此有一个同构 $FGb\cong b$。
  因此，根据 \cref{ct:ffeso}，$F$ 是一个范畴的等价。
\end{proof}

当然，还有第三个相似的概念用于（前）范畴：相等性。
然而，一致性公理 (univalence axiom) 表明它与同构一致。

\begin{lem}\label{ct:cat-eq-iso}
如果 $A$ 和 $B$ 是前范畴，那么函数
\[(\id A B) \to (A\cong B)\]
（通过从恒等函子归纳定义）是一个类型等价。
\end{lem}
\begin{proof}
  正如通常对于依赖和类型，给出一个 $\id A B$ 的元素等价于给出
  \begin{itemize}
    \item 一个恒等式 $P_0:\id{A_0}{B_0}$，
    \item 对于每个 $a,b:A_0$，一个恒等式
    \[P_{a,b}:\id{\hom_A(a,b)}{\hom_B(\trans {P_0} a,\trans {P_0} b)},\]
    \item 恒等式 $\id{\trans {(P_{a,a})} {1_a}}{1_{\trans {P_0} a}}$ 和
    \narrowequation{\id{\trans {(P_{a,c})} {gf}}{\trans {(P_{b,c})} g \circ \trans {(P_{a,b})} f}。}
  \end{itemize}
  （再次使用同源集的身份类型是纯命题的事实。）
  然而，根据一致性，这等价于给出
  \begin{itemize}
    \item 一个类型的等价 $F_0:\eqv{A_0}{B_0}$，
    \item 对于每个 $a,b:A_0$，一个类型的等价
    \[F_{a,b}:\eqv{\hom_A(a,b)}{\hom_B(F_0 (a),F_0 (b))},\]
    \item 和恒等式 $\id{F_{a,a}(1_a)}{1_{F_0 (a)}}$ 和 $\id{F_{a,c}(gf)}{F_{b,c} (g)\circ F_{a,b} (f)}$。
  \end{itemize}
  但这正是一个函子 $F:A\to B$，它是一个范畴的同构。
  并且通过对恒等式的归纳，这个等价 $\eqv{(\id A B)}{(A\cong B)}$ 等于通过归纳获得的那个。
\end{proof}

因此，对于范畴，相等性也等同于等价。
我们可以将此解释为，范畴、函子和自然变换不仅形成了一个前 2-范畴 (pre-2-category)，还形成了一个 2-范畴（参见 \cref{ct:pre2cat}）。

\begin{thm}\label{ct:cat-2cat}
如果 $A$ 和 $B$ 是范畴，那么函数
\[(\id A B) \to (\cteqv A B)\]
（通过从恒等函子归纳定义）是一个类型等价。
\end{thm}
\begin{proof}
  根据 \cref{ct:cat-eq-iso,ct:eqv-levelwise}。
\end{proof}

因此，范畴的类型是一个 2-类型。
因为 $\cteqv A B$ 是函子类型的一个子类型，而函子是范畴的对象，所以它是一个 1-类型；因此 $\id A B$ 的恒等类型也是 1-类型。

\section{The Yoneda lemma}
\label{sec:yoneda}
\index{Yoneda!lemma|(}

Recall that we have a category \uset whose objects are sets and whose morphisms are functions.
We now show that every precategory has a \uset-valued hom-functor.
First we need to define opposites and products of (pre)categories.

\begin{defn}\label{ct:opposite-category}
  For a precategory $A$, its \define{opposite}
  \indexdef{opposite of a (pre)category}%
  \indexdef{precategory!opposite}%
  \indexdef{category!opposite}%
  $A\op$ is a precategory with the same type of objects, with $\hom_{A\op}(a,b) \defeq \hom_A(b,a)$, and with identities and composition inherited from $A$.
\end{defn}

\begin{defn}\label{ct:prod-cat}
  For precategories $A$ and $B$, their \define{product}
  \index{precategory!product of}%
  \index{category!product of}%
  \index{product!of (pre)categories}%
  $A\times B$ is a precategory with $(A\times B)_0 \defeq A_0 \times B_0$ and
  \[\hom_{A\times B}((a,b),(a',b')) \defeq \hom_A(a,a') \times \hom_B(b,b').\]
  Identities are defined by $1_{(a,b)}\defeq (1_a,1_b)$ and composition by
  \narrowequation{(g,g')(f,f') \defeq ((gf),(g'f')).}
\end{defn}

\begin{lem}\label{ct:functorexpadj}
  For precategories $A,B,C$, the following types are equivalent.
  \begin{enumerate}
  \item Functors $A\times B\to C$.
  \item Functors $A\to C^B$.
  \end{enumerate}
\end{lem}
\begin{proof}
  Given $F:A\times B\to C$, for any $a:A$ we obviously have a functor $F_a : B\to C$.
  This gives a function $A_0 \to (C^B)_0$.
  Next, for any $f:\hom_A(a,a')$, we have for any $b:B$ the morphism $F_{(a,b),(a',b)}(f,1_b):F_a(b) \to F_{a'}(b)$.
  These are the components of a natural transformation $F_a \to F_{a'}$.
  Functoriality in $a$ is easy to check, so we have a functor $\hat{F}:A\to C^B$.

  Conversely, suppose given $G:A\to C^B$.
  Then for any $a:A$ and $b:B$ we have the object $G(a)(b):C$, giving a function $A_0 \times B_0 \to C_0$.
  And for $f:\hom_A(a,a')$ and $g:\hom_B(b,b')$, we have the morphism
  \begin{equation*}
     G(a')_{b,b'}(g)\circ G_{a,a'}(f)_b = G_{a,a'}(f)_{b'} \circ  G(a)_{b,b'}(g)
  \end{equation*}
  in $\hom_C(G(a)(b), G(a')(b'))$.
  Functoriality is again easy to check, so we have a functor $\check{G}:A\times B \to C$.

  Finally, it is also clear that these operations are inverses.
\end{proof}

Now for any precategory $A$, we have a hom-functor
\indexdef{hom-functor}%
\[\hom_A : A\op \times A \to \uset.\]
It takes a pair $(a,b): (A\op)_0 \times A_0 \jdeq A_0 \times A_0$ to the set $\hom_A(a,b)$.
For a morphism $(f,f') : \hom_{A\op\times A}((a,b),(a',b'))$, by definition we have $f:\hom_A(a',a)$ and $f':\hom_A(b,b')$, so we can define
\begin{align*}
  (\hom_A)_{(a,b),(a',b')}(f,f')
  &\defeq (g \mapsto (f'gf))\\
  &: \hom_A(a,b) \to \hom_A(a',b').
\end{align*}
Functoriality is easy to check.

By \cref{ct:functorexpadj}, therefore, we have an induced functor $\y:A\to \uset^{A\op}$, which we call the \define{Yoneda embedding}.
\indexdef{Yoneda!embedding}%
\indexdef{embedding!Yoneda}%

\begin{thm}[The Yoneda lemma]\label{ct:yoneda}
  \indexdef{Yoneda!lemma}
  For any precategory $A$, any $a:A$, and any functor $F:\uset^{A\op}$, we have an isomorphism
  \begin{equation}\label{eq:yoneda}
    \hom_{\uset^{A\op}}(\y a, F) \cong Fa.
  \end{equation}
  Moreover, this is natural in both $a$ and $F$.
\end{thm}
\begin{proof}
  Given a natural transformation $\alpha:\y a \to F$, we can consider the component $\alpha_a : \y a(a) \to F a$.
  Since $\y a(a)\jdeq \hom_A(a,a)$, we have $1_a : \y a(a)$, so that $\alpha_a(1_a) : F a$.
  This gives a function $(\alpha \mapsto \alpha_a(1_a))$ from left to right in~\eqref{eq:yoneda}.

  In the other direction, given $x:F a$, we define $\alpha:\y a \to F$ by
  \[\alpha_{a'}(f) \defeq F_{a,a'}(f)(x). \]
  Naturality is easy to check, so this gives a function from right to left in~\eqref{eq:yoneda}.

  To show that these are inverses, first suppose given $x:F a$.
  Then with $\alpha$ defined as above, we have $\alpha_a(1_a) = F_{a,a}(1_a)(x) = 1_{F a}(x) = x$.
  On the other hand, if we suppose given $\alpha:\y a \to F$ and define $x$ as above, then for any $f:\hom_A(a',a)$ we have
  \begin{align*}
    \alpha_{a'}(f)
    &= \alpha_{a'} (\y a_{a,a'}(f)(1_a))\\
    &= (\alpha_{a'}\circ \y a_{a,a'}(f))(1_a)\\
    &= (F_{a,a'}(f)\circ \alpha_a)(1_a)\\
    &= F_{a,a'}(f)(\alpha_a(1_a))\\
    &= F_{a,a'}(f)(x).
  \end{align*}
  Thus, both composites are equal to identities.
  We leave the proof of naturality to the reader.
\end{proof}

\begin{cor}\label{ct:yoneda-embedding}
  The Yoneda embedding $\y :A\to \uset^{A\op}$ is fully faithful.
\end{cor}
\begin{proof}
  By \cref{ct:yoneda}, we have
  \[ \hom_{\uset^{A\op}}(\y a, \y b) \cong \y b(a) \jdeq \hom_A(a,b). \]
  It is easy to check that this isomorphism is in fact the action of \y on hom-sets.
\end{proof}

\begin{cor}\label{ct:yoneda-mono}
  If $A$ is a category, then $\y_0 : A_0 \to (\uset^{A\op})_0$ is an embedding.
  In particular, if $\y a = \y b$, then $a=b$.
\end{cor}
\begin{proof}
  By \cref{ct:yoneda-embedding}, \y induces an isomorphism on sets of isomorphisms.
  But as $A$ and $\uset^{A\op}$ are categories and \y is a functor, this is equivalently an isomorphism on identity types, which is the definition of being an embedding.
\end{proof}

\begin{defn}\label{ct:representable}
  A functor $F:\uset^{A\op}$ is said to be \define{representable}
  \indexdef{functor!representable}%
  \indexdef{representable functor}%
  if there exists $a:A$ and an isomorphism $\y a \cong F$.
\end{defn}

\begin{thm}\label{ct:representable-prop}
  If $A$ is a category, then the type ``$F$ is representable'' is a mere proposition.
\end{thm}
\begin{proof}
  By definition ``$F$ is representable'' is just the fiber of $\y_0$ over $F$.
  Since $\y_0$ is an embedding by \cref{ct:yoneda-mono}, this fiber is a mere proposition.
\end{proof}

In particular, in a category, any two representations of the same functor are equal.
We can use this to give a different proof of \cref{ct:adjprop}.
First we give a characterization of adjunctions in terms of representability.

\begin{lem}\label{ct:adj-repr}
  For any precategories $A$ and $B$ and a functor $F:A\to B$, the following types are equivalent.
  \begin{enumerate}
  \item $F$ is a left adjoint\index{adjoint!functor}.\label{item:ct:ar1}
  \item For each $b:B$, the functor $(a \mapsto \hom_B(Fa,b))$ from $A\op$ to \uset is representable\index{representable functor}.\label{item:ct:ar2}
  \end{enumerate}
\end{lem}
\begin{proof}
  An element of the type~\ref{item:ct:ar2} consists of a function $G_0:B_0 \to A_0$ together with, for every $a:A$ and $b:B$ an isomorphism
  \[ \gamma_{a,b}:\hom_B(Fa,b) \cong \hom_A(a,G_0 b) \]
  such that $\gamma_{a,b}(g \circ Ff) = \gamma_{a',b}(g)\circ f$ for $f:\hom_{A}(a,a')$.

  Given this, for $a:A$ we define $\eta_a \defeq \gamma_{a,Fa}(1_{Fa})$, and for $b:B$ we define $\epsilon_b \defeq \inv{(\gamma_{Gb,b})}(1_{Gb})$.
  Now for $g:\hom_B(b,b')$ we define
  \[ G_{b,b'}(g) \defeq \gamma_{G b, b'}(g \circ \epsilon_b) \]
  The verifications that $G$ is a functor and $\eta$ and $\epsilon$ are natural transformations satisfying the triangle identities are exactly as in the classical case, and as they are all mere propositions we will not care about their values.
  Thus, we have a function~\ref{item:ct:ar2}$\to$\ref{item:ct:ar1}.

  In the other direction, if $F$ is a left adjoint, we of course have $G_0$ specified, and we can take $\gamma_{a,b}$ to be the composite
  \[ \hom_B(Fa,b)
  \xrightarrow{G_{Fa,b}} \hom_A(GFa,Gb)
  \xrightarrow{(\blank\circ \eta_a)} \hom_A(a,Gb).
  \]
  This is clearly natural since $\eta$ is, and it has an inverse given by
  \[ \hom_A(a,Gb)
  \xrightarrow{F_{a,Gb}} \hom_B(Fa,FGb)
  \xrightarrow{(\epsilon_b \circ \blank )} \hom_A(Fa,b)
  \]
  (by the triangle identities).
  Thus we also have~\ref{item:ct:ar1}$\to$~\ref{item:ct:ar2}.

  For the composite~\ref{item:ct:ar2}$\to$\ref{item:ct:ar1}$\to$~\ref{item:ct:ar2}, clearly the function $G_0$ is preserved, so it suffices to check that we get back $\gamma$.
  But the new $\gamma$ is defined to take $f:\hom_B(Fa,b)$ to
  \begin{align*}
    G(f) \circ \eta_a
    &\jdeq \gamma_{G Fa, b}(f \circ \epsilon_{Fa}) \circ \eta_a\\
    &= \gamma_{G Fa, b}(f \circ \epsilon_{Fa} \circ F\eta_a)\\
    &= \gamma_{G Fa, b}(f)
  \end{align*}
  so it agrees with the old one.

  Finally, for~\ref{item:ct:ar1}$\to$\ref{item:ct:ar2}$\to$~\ref{item:ct:ar1}, we certainly get back the functor $G$ on objects.
  The new $G_{b,b'}:\hom_B(b,b') \to \hom_A(Gb,Gb')$ is defined to take $g$ to
  \begin{align*}
    \gamma_{G b, b'}(g \circ \epsilon_b)
    &\jdeq G(g \circ \epsilon_b) \circ \eta_{Gb}\\
    &= G(g) \circ G\epsilon_b \circ \eta_{Gb}\\
    &= G(g)
  \end{align*}
  so it agrees with the old one.
  The new $\eta_a$ is defined to be $\gamma_{a,Fa}(1_{Fa}) \jdeq G(1_{Fa}) \circ \eta_a$, so it equals the old $\eta_a$.
  And finally, the new $\epsilon_b$ is defined to be $\inv{(\gamma_{Gb,b})}(1_{Gb}) \jdeq \epsilon_b \circ F(1_{Gb})$, which also equals the old $\epsilon_b$.
\end{proof}

\begin{cor}\label{ct:adjprop2}[\cref{ct:adjprop}]
  If $A$ is a category and $F:A\to B$, then the type ``$F$ is a left adjoint'' is a mere proposition.
\end{cor}
\begin{proof}
  By \cref{ct:representable-prop}, if $A$ is a category then the type in \cref{ct:adj-repr}\ref{item:ct:ar2} is a mere proposition.
\end{proof}
\index{Yoneda!lemma|)}


\section{Strict categories}
\label{sec:strict-categories}

\index{bargaining|(}%

\begin{defn}\label{ct:strict-category}
  A \define{strict category}
  \indexdef{category!strict}%
  \indexdef{strict!category}%
  is a precategory whose type of objects is a set.
\end{defn}

In accordance with the mathematical red herring principle,\index{red herring principle} a strict category is not necessarily a category.
In fact, a category is a strict category precisely when it is gaunt (\cref{ct:gaunt}).
\index{gaunt category}%
\index{category!gaunt}%
Most of the time, category theory is about categories, not strict ones, but sometimes one wants to consider strict categories.
The main advantage of this is that strict categories have a stricter notion of ``sameness'' than equivalence, namely isomorphism (or equivalently, by \cref{ct:cat-eq-iso}, equality).

Here is one origin of strict categories.

\begin{eg}\label{ct:mono-cat}
  Let $A$ be a precategory and $x:A$ an object.
  Then there is a precategory $\mathsf{mono}(A,x)$ as follows:
  \index{monomorphism}
  \indexsee{mono}{monomorphism}
  \indexsee{monic}{monomorphism}
  \begin{itemize}
  \item Its objects consist of an object $y:A$ and a monomorphism $m:\hom_A(y,x)$.
    (As usual, $m:\hom_A(y,x)$ is a \define{monomorphism} (or is \define{monic}) if $(m\circ f = m\circ g) \Rightarrow (f=g)$.)
  \item Its morphisms from $(y,m)$ to $(z,n)$ are arbitrary morphisms from $y$ to $z$ in $A$ (not necessarily respecting $m$ and $n$).
  \end{itemize}
  An equality $(y,m)=(z,n)$ of objects in $\mathsf{mono}(A,x)$ consists of an equality $p:y=z$ and an equality $\trans{p}{m}=n$, which by \cref{ct:idtoiso-trans} is equivalently an equality $m=n\circ \idtoiso(p)$.
  Since hom-sets are sets, the type of such equalities is a mere proposition.
  But since $m$ and $n$ are monomorphisms, the type of morphisms $f$ such that $m = n\circ f$ is also a mere proposition.
  Thus, if $A$ is a category, then $(y,m)=(z,n)$ is a mere proposition, and hence $\mathsf{mono}(A,x)$ is a strict category.
\end{eg}

This example can be dualized, and generalized in various ways.
Here is an interesting application of strict categories.

\begin{eg}\label{ct:galois}
  Let $E/F$ be a finite Galois extension
  \index{Galois!extension}%
  of fields, and $G$ its Galois group.
  \index{Galois!group}%
  Then there is a strict category whose objects are intermediate fields $F\subseteq K\subseteq E$, and whose morphisms are field homomorphisms\index{homomorphism!field} which fix $F$ pointwise (but need not commute with the inclusions into $E$).
  There is another strict category whose objects are subgroups $H\subseteq G$, and whose morphisms are morphisms of $G$-sets $G/H \to G/K$.
  The fundamental theorem of Galois theory
  \index{fundamental!theorem of Galois theory}%
  says that these two precategories are isomorphic (not merely equivalent).
\end{eg}

\index{bargaining|)}%

\section{\texorpdfstring{$\dagger$}{†}-categories}
\label{sec:dagger-categories}

It is also worth mentioning a useful kind of precategory whose type of objects is not a set, but which is not a category either.

\begin{defn}\label{ct:dagger-precategory}
  A \define{$\dagger$-precategory}
  \indexdef{.dagger-precategory@$\dagger$-precategory}%
  \indexdef{precategory!.dagger-@$\dagger$-}%
  is a precategory $A$ together with the following.
  \begin{enumerate}
  \item For each $x,y:A$, a function $\dgr{(-)}:\hom_A(x,y) \to \hom_A(y,x)$.
  \item For all $x:A$, we have $\dgr{(1_x)} = 1_x$.
  \item For all $f,g$ we have $\dgr{(g\circ f)} = \dgr f \circ \dgr g$.
  \item For all $f$ we have $\dgr{(\dgr f)} = f$.
  \end{enumerate}
\end{defn}

\begin{defn}\label{ct:unitary}
  A morphism $f:\hom_A(x,y)$ in a $\dagger$-precategory is \define{unitary}
  \indexdef{.dagger-precategory@$\dagger$-precategory!unitary morphism in}%
  \indexdef{unitary morphism}%
  \indexdef{morphism!unitary}%
  \indexdef{isomorphism!unitary}%
  if $\dgr f \circ f = 1_x$ and $f\circ \dgr f = 1_y$.
\end{defn}

Of course, every unitary morphism is an isomorphism, and being unitary is a mere proposition.
Thus for each $x,y:A$ we have a set of unitary isomorphisms from $x$ to $y$, which we denote $(x\unitaryiso y)$.

\begin{lem}\label{ct:idtounitary}
  If $p:(x=y)$, then $\idtoiso(p)$ is unitary.
\end{lem}
\begin{proof}
  By induction, we may assume $p$ is $\refl x$.
  But then $\dgr{(1_x)} \circ 1_x = 1_x\circ 1_x = 1_x$ and similarly.
\end{proof}

\begin{defn}\label{ct:dagger-category}
  A \define{$\dagger$-category}
  \indexdef{.dagger-category@$\dagger$-category}%
  is a $\dagger$-precategory such that for all $x,y:A$, the function
  \[ (x=y) \to (x \unitaryiso y) \]
  from \cref{ct:idtounitary} is an equivalence.
\end{defn}

\begin{eg}\label{ct:rel-dagger-cat}
  The category \urel from \cref{ct:rel} becomes a $\dagger$-pre\-cat\-e\-go\-ry if we define $(\dgr R)(y,x) \defeq R(x,y)$.
  The proof that \urel is a category actually shows that every isomorphism is unitary; hence \urel is also a $\dagger$-category.
\end{eg}

\begin{eg}\label{ct:groupoid-dagger-cat}
  Any groupoid becomes a $\dagger$-category if we define $\dgr f \defeq \inv{f}$.
\end{eg}

\begin{eg}\label{ct:hilb}
  Let \uhilb be the following precategory.
  \begin{itemize}
  \item Its objects are finite-dimensional \index{finite!-dimensional vector space} vector spaces\index{vector!space} equipped with an inner product $\langle \blank,\blank\rangle$.
  \item Its morphisms are arbitrary linear maps.
    \index{function!linear}%
    \indexsee{linear map}{function, linear}%
  \end{itemize}
  By standard linear algebra, any linear map $f:V\to W$ between finite
  dimensional inner product spaces has a uniquely defined adjoint\index{adjoint!linear map} $\dgr f:W\to V$, characterized by $\langle f v,w\rangle = \langle v,\dgr f w\rangle$.
  In this way, \uhilb becomes a $\dagger$-precategory.
  Moreover, a linear isomorphism is unitary precisely when it is an \define{isometry},
  \indexdef{isometry}%
  i.e.\ $\langle fv,fw\rangle = \langle v,w\rangle$.
  It follows from this that \uhilb is a $\dagger$-category, though it is not a category (not every linear isomorphism is unitary).
\end{eg}

There has been a good deal of general theory developed for $\dagger$-cat\-e\-gor\-ies under classical\index{mathematics!classical}\index{classical!category theory} foundations.
It was observed early on that the unitary isomorphisms, not arbitrary isomorphisms, are the correct notion of ``sameness'' for objects of a $\dagger$-category, which has caused some consternation among category theorists.
Homotopy type theory resolves this issue by identifying $\dagger$-categories, like strict categories, as simply a different kind of precategory.


\section{The structure identity principle}
\label{sec:sip}
 \index{structure!identity principle|(}

The \emph{structure identity principle} is an informal principle
that expresses that isomorphic structures are identical.  We aim to
prove a general abstract result which can be applied to a wide family
of notions of structure, where structures may be many-sorted or even
dependently-sorted, infinitary, or even higher order.

The simplest kind of single-sorted structure consists of a type with
no additional structure.  The univalence axiom expresses the structure identity principle for that
notion of structure in a strong form: for types $A,B$, the
canonical function $(A=B)\to (\eqv A B)$ is an equivalence.

We start with a precategory $X$.  In our application to
single-sorted first order structures, $X$ will be the category %\uset%
of $\bbU$-small sets, where $\bbU$ is a univalent type universe.

\begin{defn}\label{ct:sig}
  A \define{notion of structure}
  \indexdef{structure!notion of}%
  $(P,H)$ over $X$ consists of the following.
  \begin{enumerate}
  \item A type family $P:X_0 \to \type$.
    For each $x:X_0$ the elements of $Px$ are called \define{$(P,H)$-structures}
    \indexsee{PH-structure@$(P,H)$-structure}{structure}%
    \indexdef{structure!PH@$(P,H)$-}%
    on $x$.
  \item For $x,y:X_0$, $f:\hom_X(x,y)$ and $\alpha:Px$, $\;\beta:Py$, a mere proposition
  \[ H_{\alpha\beta}(f).\]
    If $H_{\alpha\beta}(f)$ is true, we say that $f$ is a \define{$(P,H)$-homomorphism}
    \indexdef{homomorphism!of structures}%
    \indexdef{structure!homomorphism of}%
    from $\alpha$ to $\beta$.
  \item For $x:X_0$ and $\alpha:Px$, we have $H_{\alpha\alpha}(1_x)$.\label{item:sigid}
  \item For $x,y,z:X_0$ and $\alpha:Px$, $\;\beta:Py$, $\;\gamma:Pz$,
if $f:\hom_X(x,y)$ and $g:\hom_X(y,z)$, we have\label{item:sigcmp}
  \[ H_{\alpha\beta}(f)\to H_{\beta\gamma}(g)\to H_{\alpha\gamma}(g\circ   f).\]
   \end{enumerate}
  When $(P,H)$ is a notion of structure, for $\alpha,\beta:Px$ we define
  \[ (\alpha\leq_x\beta) \defeq H_{\alpha\beta}(1_x).\]
  By~\ref{item:sigid} and~\ref{item:sigcmp}, this is a preorder (\cref{ct:orders}) with $Px$ its type of objects.
  We say that $(P,H)$ is a \define{standard notion of structure}
  \indexdef{structure!standard notion of}%
  if this preorder is in fact a partial order, for all $x:X$.
\end{defn}

Note that for a standard notion of structure, each type $Px$ must actually be a set.
We now define, for any notion of structure $(P,H)$, a \define{precategory of $(P,H)$-structures},
\indexdef{precategory!of PH-structures@of $(P,H)$-structures}%
\indexdef{structure!precategory of PH@precategory of $(P,H)$-}%
$A = \mathsf{Str}_{(P,H)}(X)$.
\begin{itemize}
\item The type of objects of $A$ is the type $A_0 \defeq \sm{x:X_0} Px$.
  If $a\jdeq (x,\alpha):A_0$, we may write $|a| \defeq x$.
\item For $(x,\alpha):A_0$ and $(y,\beta):A_0$, we define
  \[\hom_A((x,\alpha),(y,\beta)) \defeq \setof{ f:x \to y | H_{\alpha\beta}(f)}.\]
\end{itemize}
The composition and identities are inherited from $X$; conditions~\ref{item:sigid} and \ref{item:sigcmp} ensure that these lift to $A$.

\begin{thm}[Structure identity principle]\label{thm:sip}
  \indexdef{structure!identity principle}%
  If $X$ is a category and $(P,H)$ is a standard notion of structure over $X$, then the precategory $\mathsf{Str}_{(P,H)}(X)$ is a category.
\end{thm}
\begin{proof}
  By the definition of equality in dependent pair types, to give an equality $(x,\alpha)=(y,\beta)$ consists of
  \begin{itemize}
  \item An equality $p:x=y$, and
  \item An equality $\trans{p}{\alpha}=\beta$.
  \end{itemize}
  Since $P$ is set-valued, the latter is a mere proposition.
  On the other hand, it is easy to see that an isomorphism $(x,\alpha)\cong (y,\beta)$ in $\mathsf{Str}_{(P,H)}(X)$ consists of
  \begin{itemize}
  \item An isomorphism $f:x\cong y$ in $X$, such that
  \item $H_{\alpha\beta}(f)$ and $H_{\beta\alpha}(\inv f)$.
  \end{itemize}
  Of course, the second of these is also a mere proposition.
  And since $X$ is a category, the function $(x=y) \to (x\cong y)$ is an equivalence.
  Thus, it will suffice to show that for any $p:x=y$ and for any $(\alpha:Px)$, $(\beta:Py)$, we have $\trans{p}{\alpha}=\beta$ if and only if both  $H_{\alpha\beta}(\idtoiso (p))$ and $H_{\beta\alpha}(\inv{\idtoiso(p)})$.

  The ``only if'' direction is just the existence of the function $\idtoiso$ for the category $\mathsf{Str}_{(P,H)}(X)$.
  For the ``if'' direction, by induction on $p$ we may assume that $y\jdeq x$ and $p\jdeq\refl x$.
  However, in this case $\idtoiso (p)\jdeq 1_x$ and therefore $\inv{\idtoiso(p)}=1_x$.
  Thus, $\alpha\leq_x \beta$ and $\beta\leq_x \alpha$, which implies $\alpha=\beta$ since $(P,H)$ is a standard notion of structure.
\end{proof}

As an example, this methodology gives an alternative way to express the proof of \cref{ct:functor-cat}.

\begin{eg}\label{ct:sip-functor-cat}
  Let $A$ be a precategory and $B$ a category.
  There is a precategory $B^{A_0}$ whose objects are functions $A_0 \to B_0$, and whose set of morphisms from $F_0:A_0 \to B_0$ to $G_0:A_0 \to B_0$ is $\prd{a:A_0} \hom_B(F_0 a, G_0 a)$.
  Composition and identities are inherited directly from those in $B$.
  It is easy to show that $\gamma:\hom_{B^{A_0}}(F_0, G_0)$ is an isomorphism exactly when each component $\gamma_a$ is an isomorphism, so that we have $\eqv{(F_0 \cong G_0)}{\prd{a:A_0} (F_0 a \cong G_0 a)}$.
  Moreover, the map $\idtoiso : (F_0 = G_0) \to (F_0 \cong G_0)$ of $B^{A_0}$ is equal to the composite
  \[ (F_0 = G_0) \longrightarrow \prd{a:A_0} (F_0 a  = G_0 a) \longrightarrow \prd{a:A_0} (F_0 a \cong G_0 a) \longrightarrow (F_0 \cong G_0) \]
  in which the first map is an equivalence by function extensionality, the second because it is a dependent product of equivalences (since $B$ is a category), and the third as remarked above.
  Thus, $B^{A_0}$ is a category.

  Now we define a notion of structure on $B^{A_0}$ for which $P(F_0)$ is the type of operations $F:\prd{a,a':A_0} \hom_A(a,a') \to \hom_B(F_0 a,F_0 a')$ which extend $F_0$ to a functor (i.e.\ preserve composition and identities).
  This is a set since each $\hom_B(\blank,\blank)$ is so.
  Given such $F$ and $G$, we define $\gamma:\hom_{B^{A_0}}(F_0, G_0)$ to be a homomorphism if it forms a natural transformation.\index{natural!transformation}
  In \cref{ct:functor-precat} we essentially verified that this is a notion of structure.
  Moreover, if $F$ and $F'$ are both structures on $F_0$ and the identity is a natural transformation from $F$ to $F'$, then for any $f:\hom_A(a,a')$ we have $F'f = F'f \circ 1_{F_0 a} = 1_{F_0 a}\circ F f = F f$.
  Applying function extensionality, we conclude $F = F'$.
  Thus, we have a \emph{standard} notion of structure, and so by \cref{thm:sip}, the precategory $B^A$ is a category.
\end{eg}

As another example, we consider categories of structures for a first-order signature.
We define a \define{first-order signature},
\indexdef{first-order!signature}%
\indexdef{signature!first-order}%
$\Omega$, to consist of sets $\Omega_0$ and $\Omega_1$ of function symbols, $\omega:\Omega_0$, and relation symbols, $\omega:\Omega_1$, each having an arity\index{arity} $|\omega|$ that is a set.
An \define{$\Omega$-structure}
\indexdef{structure!Omega@$\Omega$-}%
\indexsee{omega-structure@$\Omega$-structure}{structure}%
$a$ consists of a set $|a|$ together with an assignment of an $|\omega|$-ary function $\omega^a:|a|^{|\omega|}\to |a|$ on $|a|$ to each function symbol, $\omega$, and an assignment of an $|\omega|$-ary relation $\omega^a$ on $|a|$, assigning a mere proposition $\omega^ax$ to each $x:|a|^{|\omega|}$, to each relation symbol.
And given $\Omega$-structures $a,b$, a function $f:|a|\to |b|$ is a \define{homomorphism $a\to b$}
\indexdef{homomorphism!of Omega-structures@of $\Omega$-structures}%
\indexdef{structure!homomorphism of Omega@homomorphism of $\Omega$-}%
if it preserves the structure; i.e.\ if for each symbol $\omega$ of the signature and each $x:|a|^{|\omega|}$,
\begin{enumerate}
\item $f(\omega^ax) = \omega^b(f\circ x)$ if $\omega:\Omega_0$, and
\item $\omega^ax\to\omega^b(f\circ x)$ if $\omega:\Omega_1$.
\end{enumerate}
Note that each $x:|a|^{|\omega|}$ is a function $x:|\omega|\to |a|$ so that $f\circ x : b^\omega$.

Now we assume given a (univalent) universe $\bbU$ and a $\bbU$-small signature $\Omega$; i.e. $|\Omega|$ is a $\bbU$-small set and, for each $\omega:|\Omega|$, the set $|\omega|$ is $\bbU$-small.
Then we have the category $\uset_\bbU$ of $\bbU$-small sets.  We want to define the precategory of $\bbU$-small $\Omega$-structures over $\uset_\bbU$ and use \cref{thm:sip} to show that it is a category.

We use the first order signature $\Omega$ to give us a standard notion of structure $(P,H)$ over $\uset_\bbU$.

\begin{defn}\label{defn:fo-notion-of-structure}
\mbox{}
\begin{enumerate}
\item For each $\bbU$-small set $x$ define
  \[ Px \defeq P_0x\times P_1x.\]
  Here
  %
  \begin{align*}
    P_0x &\defeq \prd{\omega:\Omega_0} x^{|\omega|}\to x, \mbox{ and } \\
    P_1x &\defeq \prd{\omega:\Omega_1} x^{|\omega|}\to \propU,
  \end{align*}
\item For $\bbU$-small sets $x,y$ and
  $\alpha:P^\omega x,\;\beta:P^\omega y,\; f:x\to y$, define
  \[ H_{\alpha\beta}(f) \defeq H_{0,\alpha\beta}(f)\wedge H_{1,\alpha\beta}(f).\]
  Here
  \begin{align*}
    H_{0,\alpha\beta}(f) &\defeq
    \fall{\omega:\Omega_0}{u:x^{|\omega|}} f(\alpha u)=\;\beta(f\circ u),
    \mbox{ and }\\
    H_{1,\alpha\beta}(f) &\defeq
    \fall{\omega:\Omega_1}{u:x^{|\omega|}} \alpha u\to\beta(f\circ u).
  \end{align*}
\end{enumerate}
\end{defn}

It is now routine to check that $(P,H)$ is a standard notion of structure over $\uset_\bbU$ and hence we may use \cref{thm:sip} to get that the precategory $Str_{(P,H)}(\uset_\bbU)$ is a category.  It only remains to observe that this is essentially the same as the precategory of $\bbU$-small $\Omega$-structures over $\uset_\bbU$.
 \index{structure!identity principle|)}


\section{The Rezk completion}
\label{sec:rezk}

In this section we will give a universal way to replace a precategory by a category.
In fact, we will give two.
Both rely on the fact that ``categories see weak equivalences as equivalences''.

To prove this, we begin with a couple of lemmas which are completely standard category theory, phrased carefully so as to make sure we are using the eliminator for $\truncf{-1}$ correctly.
One would have to be similarly careful in classical\index{mathematics!classical}\index{classical!category theory} category theory if one wanted to avoid the axiom of choice: any time we want to define a function, we need to characterize its values uniquely somehow.

\begin{lem}\label{ct:esosurj-postcomp-faithful}
  If $A,B,C$ are precategories and $H:A\to B$ is an essentially surjective functor, then $(\blank\circ H):C^B \to C^A$ is faithful.
\end{lem}
\begin{proof}
  Let $F,G:B\to C$, and $\gamma,\delta:F\to G$ be such that $\gamma H = \delta H$; we must show $\gamma=\delta$.
  Thus let $b:B$; we want to show $\gamma_b=\delta_b$.
  This is a mere proposition, so since $H$ is essentially surjective, we may assume given an $a:A$ and an isomorphism $f:Ha\cong b$.
  But now we have
  \[ \gamma_b = G(f) \circ \gamma_{Ha} \circ F(\inv{f})
  = G(f) \circ \delta_{Ha} \circ F(\inv{f})
  = \delta_b.\qedhere
  \]
\end{proof}

\begin{lem}\label{ct:esofull-precomp-ff}
  If $A,B,C$ are precategories and $H:A\to B$ is essentially surjective and full, then $(\blank\circ H):C^B \to C^A$ is fully faithful.
\end{lem}
\begin{proof}
  It remains to show fullness.
  Thus, let $F,G:B\to C$ and $\gamma:FH \to GH$.
  We claim that for any $b:B$, the type
  \begin{equation}\label{eq:fullprop}
    \sm{g:\hom_C(Fb,Gb)} \prd{a:A}{f:Ha\cong b} (\gamma_a =  \inv{Gf}\circ g\circ Ff)
  \end{equation}
  is contractible.
  Since contractibility is a mere property, and $H$ is essentially surjective, we may assume given $a_0:A$ and $h:Ha_0\cong b$.

  Now take $g\defeq Gh \circ \gamma_{a_0} \circ \inv{Fh}$.
  Then given any other $a:A$ and $f:Ha\cong b$, we must show $\gamma_a =  \inv{Gf}\circ g\circ Ff$.
  Since $H$ is full, there merely exists a morphism $k:\hom_A(a,a_0)$ such that $Hk = \inv{h}\circ f$.
  And since our goal is a mere proposition, we may assume given some such $k$.
  Then we have
  \begin{align*}
    \gamma_a &= \inv{GHk}\circ \gamma_{a_0} \circ FHk\\
    &= \inv{Gf} \circ Gh \circ \gamma_{a_0} \circ \inv{Fh} \circ Ff\\
    &= \inv{Gf}\circ g\circ Ff.
  \end{align*}
  Thus,~\eqref{eq:fullprop} is inhabited.
  It remains to show it is a mere proposition.
  Let $g,g':\hom_C(Fb, Gb)$ be such that for all $a:A$ and $f:Ha\cong b$, we have both $(\gamma_a =  \inv{Gf}\circ g\circ Ff)$ and $(\gamma_a =  \inv{Gf}\circ g'\circ Ff)$.
  The dependent product types are mere propositions, so all we have to prove is $g=g'$.
  But this is a mere proposition, so we may assume $a_0:A$ and $h:Ha_0\cong b$, in which case we have
  \[ g = Gh \circ \gamma_{a_0} \circ \inv{Fh} = g'.\]
  %
  This proves that~\eqref{eq:fullprop} is contractible for all $b:B$.
  Now we define $\delta:F\to G$ by taking $\delta_b$ to be the unique $g$ in~\eqref{eq:fullprop} for that $b$.
  To see that this is natural, suppose given $f:\hom_B(b,b')$; we must show $Gf \circ \delta_b = \delta_{b'}\circ Ff$.
  As before, we may assume $a:A$ and $h:Ha\cong b$, and likewise $a':A$ and $h':Ha'\cong b'$.
  Since $H$ is full as well as essentially surjective, we may also assume $k:\hom_A(a,a')$ with $Hk = \inv{h'}\circ f\circ h$.

  Since $\gamma$ is natural, $GHk\circ \gamma_a = \gamma_{a'} \circ FHk$.
  Using the definition of $\delta$, we have
  \begin{align*}
    Gf \circ \delta_b
    &= Gf \circ Gh \circ \gamma_a \circ \inv{Fh}\\
    &= Gh' \circ GHk\circ \gamma_a \circ \inv{Fh}\\
    &= Gh' \circ \gamma_{a'} \circ FHk \circ \inv{Fh}\\
    &= Gh' \circ \gamma_{a'} \circ \inv{Fh'} \circ Ff\\
    &= \delta_{b'} \circ Ff.
  \end{align*}
  Thus, $\delta$ is natural.
  Finally, for any $a:A$, applying the definition of $\delta_{Ha}$ to $a$ and $1_a$, we obtain $\gamma_a = \delta_{Ha}$.
  Hence, $\delta \circ H = \gamma$.
\end{proof}

The rest of the theorem follows almost exactly the same lines, with the category-ness of $C$ inserted in one crucial step, which we have italicized below for emphasis.
This is the point at which we are trying to define a function into \emph{objects} without using choice, and so we must be careful about what it means for an object to be ``uniquely specified''.
In classical\index{mathematics!classical}\index{classical!category theory} category theory, all one can say is that this object is specified up to unique isomorphism, but in set-theoretic foundations this is not a sufficient amount of uniqueness to give us a function without invoking \choice{}.
In univalent foundations, however, if $C$ is a category, then isomorphism is equality, and we have the appropriate sort of uniqueness (namely, living in a contractible space).

\index{weak equivalence!of precategories|(}%

\begin{thm}\label{ct:cat-weq-eq}
  If $A,B$ are precategories, $C$ is a category, and $H:A\to B$ is a weak equivalence, then $(\blank\circ H):C^B \to C^A$ is an isomorphism.
\end{thm}
\begin{proof}
  By \cref{ct:functor-cat}, $C^B$ and $C^A$ are categories.
  Thus, by \cref{ct:eqv-levelwise} it will suffice to show that $(\blank\circ H)$ is an equivalence.
  But since we know from the preceding two lemmas that it is fully faithful, by \cref{ct:catweq} it will suffice to show that it is essentially surjective.
  Thus, suppose $F:A\to C$; we want there to merely exist a $G:B\to C$ such that $GH\cong F$.

  For each $b:B$, let $X_b$ be the type whose elements consist of:
  \begin{enumerate}
  \item An element $c:C$; and
  \item For each $a:A$ and $h:Ha\cong b$, an isomorphism $k_{a,h}:Fa\cong c$; such that\label{item:eqvprop2}
  \item For each $(a,h)$ and $(a',h')$ as in~\ref{item:eqvprop2} and each $f:\hom_A(a,a')$ such that $h'\circ Hf = h$, we have $k_{a',h'}\circ Ff = k_{a,h}$.\label{item:eqvprop3}
  \end{enumerate}
  We claim that for any $b:B$, the type $X_b$ is contractible.
  As this is a mere proposition, we may assume given $a_0:A$ and $h_0:Ha_0 \cong b$.
  Let $c^0\defeq Fa_0$.
  Next, given $a:A$ and $h:Ha\cong b$, since $H$ is fully faithful there is a unique isomorphism $g_{a,h}:a\to a_0$ with $Hg_{a,h} = \inv{h_0}\circ h$; define $k^0_{a,h} \defeq Fg_{a,h}$.
  Finally, if $h'\circ Hf = h$, then $\inv{h_0}\circ h'\circ Hf = \inv{h_0}\circ h$, hence $g_{a',h'} \circ f = g_{a,h}$ and thus $k^0_{a',h'}\circ Ff = k^0_{a,h}$.
  Therefore, $X_b$ is inhabited.

  Now suppose given another $(c^1,k^1): X_b$.
  Then $k^1_{a_0,h_0}:c^0 \jdeq Fa_0 \cong c^1$.
  \emph{Since $C$ is a category, we have $p:c^0=c^1$ with $\idtoiso(p) = k^1_{a_0,h_0}$.}
  And for any $a:A$ and $h:Ha\cong b$, by~\ref{item:eqvprop3} for $(c^1,k^1)$ with $f\defeq g_{a,h}$, we have
  \[k^1_{a,h} = k^1_{a_0,h_0} \circ k^0_{a,h} = \trans{p}{k^0_{a,h}}\]
  This gives the requisite data for an equality $(c^0,k^0)=(c^1,k^1)$, completing the proof that $X_b$ is contractible.

  Now since $X_b$ is contractible for each $b$, the type $\prd{b:B} X_b$ is also contractible.
  In particular, it is inhabited, so we have a function assigning to each $b:B$ a $c$ and a $k$.
  Define $G_0(b)$ to be this $c$; this gives a function $G_0 :B_0 \to C_0$.

  Next we need to define the action of $G$ on morphisms.
  For each $b,b':B$ and $f:\hom_B(b,b')$, let $Y_f$ be the type whose elements consist of:
  \begin{enumerate}[resume]
  \item A morphism $g:\hom_C(Gb,Gb')$, such that
  \item For each $a:A$ and $h:Ha\cong b$, and each $a':A$ and $h':Ha'\cong b'$, and any $\ell:\hom_A(a,a')$, we have\label{item:eqvprop5}
    \[ (h' \circ H\ell = f \circ h)
    \to
    (k_{a',h'} \circ F\ell = g\circ k_{a,h}). \]
  \end{enumerate}
  We claim that for any $b,b'$ and $f$, the type $Y_f$ is contractible.
  As this is a mere proposition, we may assume given $a_0:A$ and $h_0:Ha_0\cong b$, and each $a'_0:A$ and $h'_0:Ha'_0\cong b'$.
  Then since $H$ is fully faithful, there is a unique $\ell_0:\hom_A(a_0,a_0')$ such that $h'_0 \circ H\ell_0 = f \circ h_0$.
  Define $g_0 \defeq k_{a_0',h_0'} \circ F \ell_0 \circ \inv{(k_{a_0,h_0})}$.

  Now for any $a,h,a',h'$, and $\ell$ such that $(h' \circ H\ell = f \circ h)$, we have $\inv{h}\circ h_0:Ha_0\cong Ha$, hence there is a unique $m:a_0\cong a$ with $Hm = \inv{h}\circ h_0$ and hence $h\circ Hm = h_0$.
  Similarly, we have a unique $m':a_0'\cong a'$ with $h'\circ Hm' = h_0'$.
  Now by~\ref{item:eqvprop3}, we have $k_{a,h}\circ Fm = k_{a_0,h_0}$ and $k_{a',h'}\circ Fm' = k_{a_0',h_0'}$.
  We also have
  \begin{align*}
    Hm' \circ H\ell_0
    &= \inv{(h')} \circ h_0' \circ H\ell_0\\
    &= \inv{(h')} \circ f \circ h_0\\
    &= \inv{(h')} \circ f \circ h \circ \inv{h} \circ h_0\\
    &= H\ell \circ Hm
  \end{align*}
  and hence $m'\circ \ell_0 = \ell\circ m$ since $H$ is fully faithful.
  Finally, we can compute
  \begin{align*}
    g_0 \circ k_{a,h}
    &= k_{a_0',h_0'} \circ F \ell_0 \circ \inv{(k_{a_0,h_0})} \circ k_{a,h}\\
    &= k_{a_0',h_0'} \circ F \ell_0 \circ \inv{Fm}\\
    &= k_{a_0',h_0'} \circ \inv{(Fm')} \circ F\ell\\
    &= k_{a',h'}\circ F\ell.
  \end{align*}
  This completes the proof that $Y_f$ is inhabited.
  To show it is contractible, since hom-sets are sets, it suffices to take another $g_1:\hom_C(Gb,Gb')$ satisfying~\ref{item:eqvprop5} and show $g_0=g_1$.
  However, we still have our specified $a_0,h_0,a_0',h_0',\ell_0$ around, and~\ref{item:eqvprop5} implies both $g_0$ and $g_1$ must be equal to $k_{a_0',h_0'} \circ F \ell_0 \circ \inv{(k_{a_0,h_0})}$.

  This completes the proof that $Y_f$ is contractible for each $b,b':B$ and $f:\hom_B(b,b')$.
  Therefore, there is a function assigning to each such $f$ its unique inhabitant; denote this function $G_{b,b'}:\hom_B(b,b') \to \hom_C(Gb,Gb')$.
  The proof that $G$ is a functor is straightforward; in each case we can choose $a,h$ and apply~\ref{item:eqvprop5}.

  Finally, for any $a_0:A$, defining $c\defeq Fa_0$ and $k_{a,h}\defeq F g$, where $g:\hom_A(a,a_0)$ is the unique isomorphism with $Hg = h$, gives an element of $X_{Ha_0}$.
  Thus, it is equal to the specified one; hence $GHa=Fa$.
  Similarly, for $f:\hom_A(a_0,a_0')$ we can define an element of $Y_{Hf}$ by transporting along these equalities, which must therefore be equal to the specified one.
  Hence, we have $GH=F$, and thus $GH\cong F$ as desired.
\end{proof}

\index{universal!property!of Rezk completion}%
Therefore, if a precategory $A$ admits a weak equivalence functor $A\to \widehat{A}$ into a category, then that is its ``reflection'' into categories: any functor from $A$ into a category will factor essentially uniquely through $\widehat{A}$.
We now give two constructions of such a weak equivalence.

\indexsee{Rezk completion}{completion, Rezk}%
\index{completion!Rezk|(defstyle}%

\begin{thm}\label{thm:rezk-completion}
  For any precategory $A$, there is a category $\widehat A$ and a weak equivalence $A\to\widehat{A}$.
\end{thm}

\begin{proof}[First proof]
  Let $\widehat{A}_0 \defeq \setof{ F:\uset^{A\op} | \exis{a:A} (\y a \cong F)}$, with hom-sets inherited from $\uset^{A\op}$.
  Then the inclusion $\widehat{A} \to \uset^{A\op}$ is fully faithful and an embedding on objects.
  Since $\uset^{A\op}$ is a category (by \cref{ct:functor-cat}, since \uset is so by univalence), $\widehat A$ is also a category.

  Let $A\to\widehat A$ be the Yoneda embedding.
  This is fully faithful by \cref{ct:yoneda-embedding}, and essentially surjective by definition of $\widehat{A}_0$.
  Thus it is a weak equivalence.
\end{proof}

This proof is very slick, but it has the drawback that it increases universe level.
If $A$ is a category in a universe \bbU, then in this proof \uset must be at least as large as $\uset_\bbU$.
Then $\uset_\bbU$ and $(\uset_\bbU)^{A\op}$ are not themselves categories in \bbU, but only in a higher universe, and \emph{a priori} the same is true of $\widehat A$.
One could imagine a resizing axiom that could deal with this, but it is also possible to give a direct construction using higher inductive types.

\begin{proof}[Second proof]
  We define a higher inductive type $\widehat A_0$ with the following constructors:
  \begin{itemize}
  \item A function $i:A_0 \to \widehat A_0$.
  \item For each $a,b:A$ and $e:a\cong b$, an equality $je:\id{ia}{ib}$.
  \item For each $a:A$, an equality $\id{j(1_a)}{\refl{ia}}$.
  \item For each $(a,b,c:A)$, $(f:a\cong b)$, and $(g:b\cong c)$, an equality $\id{j(g \circ f)}{j(f)\ct j(g)}$.
  \item 1-truncation: for all $x,y:\widehat A_0$ and $p,q:\id x y$ and $r,s:\id p q$, an equality $\id r s$.
  \end{itemize}
  Note that for any $a,b:A$ and $p:\id a b$, we have $\id{j(\idtoiso(p))}{\map i p}$.
  This follows by path induction on $p$ and the third constructor.

  The type $\widehat A_0$ will be the type of objects of $\widehat A$; we now build all the rest of the structure.
  (The following proof is of the sort that can benefit a lot from the help of a computer proof assistant:\index{proof!assistant} it is wide and shallow with many short cases to consider, and a large part of the work consists of writing down what needs to be checked.)

  \mentalpause

  \emph{Step 1:} We define a family $\hom_{\widehat A}:\widehat A_0\to \widehat A_0 \to \set$ by double induction on $\widehat A_0$.
  Since \set is a 1-type, we can ignore the 1-truncation constructor.
  When $x$ and $y$ are of the form $ia$ and $ib$, we take $\hom_{\widehat A}(ia,ib) \defeq \hom_A(a,b)$.
  It remains to consider all the other possible pairs of constructors.

  Let us keep $x=ia$ fixed at first.
  If $y$ varies along the identity $je:\id{ib}{ib'}$, for some $e:b\cong b'$, we require an identity $\id{\hom_A(a,b)}{\hom_A(a,b')}$.
  By univalence, it suffices to give an equivalence $\eqv{\hom_A(a,b)}{\hom_A(a,b')}$.
  We take this to be the function $(e\circ \blank ):\hom_A(a,b)\to \hom_A(a,b')$.
  To see that this is an equivalence, we give its inverse as $(\inv e\circ \blank )$, with witnesses to inversion coming from the fact that $\inv e$ is the inverse of $e$ in $A$.

  As $y$ varies along the identity $\id{j(1_b)}{\refl{ib}}$, we require an identity $\id{(1_b\circ \blank )}{\refl{\hom_A(a,b)}}$; this follows from the identity axiom $\id{1_b\circ g}{g}$ of a precategory.
  Similarly, as $y$ varies along the identity $\id{j(g\circ f)}{j(f)\ct j(g)}$, we require an identity $\id{((g\circ f)\circ \blank )}{(g\circ (f\circ \blank ))}$, which follows from associativity.
  % Finally, as $y$ varies along the 1-truncation constructor, we need only to observe that \set is 1-truncated.

  Now we consider the other constructors for $x$.
  Say that $x$ varies along the identity $j(e):\id{ia}{ia'}$, for some $e:a \cong a'$; we again must deal with all the constructors for $y$.
  If $y$ is $ib$, then we require an identity $\id{\hom_A(a,b)}{\hom_A(a',b)}$.
  By univalence, this may come from an equivalence, and for this we can use $(\blank\circ \inv e)$, with inverse $(\blank\circ e)$.

  Still with $x$ varying along $j(e)$, suppose now that $y$ also varies along $j(f)$ for some $f:b\cong b'$.
  Then we need to know that the two concatenated identities
  \begin{gather*}
    \hom_A(a,b) = \hom_A(a',b) = \hom_A(a',b') \mathrlap{\qquad\text{and}}\\
    \hom_A(a,b) = \hom_A(a,b') = \hom_A(a',b')
  \end{gather*}
  are identical.
  This follows from associativity: $(f\circ \blank)\circ \inv e = f\circ (\blank\circ \inv e)$.
  The other two constructors for $y$ are trivial, since they are 2-fold equalities in sets.

  For the next two constructors of $x$, all but the first constructor for $y$ is likewise trivial.
  When $x$ varies along $j(1_a)=\refl{ia}$ and $y$ is $ib$, we use the identity axiom again.
  Similarly, when $x$ varies along $\id{j(g\circ f)}{j(f)\ct j(g)}$, we use associativity again.
  This completes the construction of $\hom_{\widehat A}:\widehat A_0 \to \widehat A_0 \to \set$.

  \mentalpause

  \emph{Step 2:} We give the precategory structure on $\widehat A$, always by induction on $\widehat A_0$.
  % The reader is probably getting bored at this point, so we skip the details.
  We are now eliminating into sets (the hom-sets of $\widehat A$), so all but the first two constructors are trivial to deal with.

  For identities, if $x$ is $ia$ then we have $\hom_{\widehat A}(x,x) \jdeq \hom_A(a,a)$ and we define $1_x \defeq 1_{ia}$.
  If $x$ varies along $je$ for $e:a\cong a'$, we must show that $\transfib{x\mapsto \hom_{\widehat A}(x,x)}{je}{1_{ia}} = 1_{ia'}$.
  But by definition of $\hom_{\widehat A}$, transporting along $je$ is given by composing with $e$ and $\inv e$, and we have $e\circ 1_{ia} \circ \inv{e} = 1_{ia'}$.

  For composition, if $x,y,z$ are $ia,ib,ic$ respectively, then $\hom_{\widehat A}$ reduces to $\hom_A$ and we can define composition in $\widehat A$ to be composition in $A$.
  And when $x$, $y$, or $z$ varies along $je$, then we verify the following equalities:
  \begin{align*}
    e \circ (g\circ f) &= (e\circ g) \circ f,\\
    g\circ f &= (g\circ \inv e) \circ (e\circ f),\\
    (g\circ f) \circ \inv e &= g \circ (f\circ \inv e).
  \end{align*}
  Finally, the associativity and unitality axioms are mere propositions, so all constructors except the first are trivial.
  But in that case, we have the corresponding axioms in $A$.

  \mentalpause

  \emph{Step 3}: We show that $\widehat A$ is a category.
  That is, we must show that for all $x,y:\widehat A$, the function $\idtoiso:(x=y) \to (x\cong y)$ is an equivalence.
  First we define, for all $x,y:\widehat A$, a function $k_{x,y}:(x\cong y) \to (x=y)$ by induction.
  As before, since our goal is a set, it suffices to deal with the first two constructors.

  When $x$ and $y$ are $ia$ and $ib$ respectively, we have $\hom_{\widehat A}(ia,ib)\jdeq \hom_A(a,b)$, with composition and identities inherited as well, so that $(ia\cong ib)$ is equivalent to $(a\cong b)$.
  But now we have the constructor $j:(a\cong b) \to (ia=ib)$.

  Next, if $y$ varies along $j(e)$ for some $e:b\cong b'$, we must show that for $f:a\cong b$ we have $j(\trans{j(e)}{f}) = j(f) \ct j(e)$.
  But by definition of $\hom_{\widehat A}$ on equalities, transporting along $j(e)$ is equivalent to post-composing with $e$, so this equality follows from the last constructor of $\widehat A_0$.
  The remaining case when $x$ varies along $j(e)$ for $e:a\cong a'$ is similar.
  This completes the definition of $k:\prd{x,y:\widehat A_0} (x\cong y) \to (x=y)$.

  Now one thing we must show is that if $p:x=y$, then $k(\idtoiso(p))=p$.
  By induction on $p$, we may assume it is $\refl x$, and hence $\idtoiso(p)\jdeq 1_x$.
  Now we argue by induction on $x:\widehat A_0$, and since our goal is a mere proposition (since $\widehat A_0$ is a 1-type), all constructors except the first are trivial.
  But if $x$ is $ia$, then $k(1_{ia}) \jdeq j(1_a)$, which is equal to $\refl{ia}$ by the third constructor of $\widehat A_0$.

  To complete the proof that $\widehat A$ is a category, we must show that if $f:x\cong y$, then $\idtoiso(k(f))=f$.
  By induction we may assume that $x$ and $y$ are $ia$ and $ib$ respectively, in which case $f$ must arise from an isomorphism $g:a\cong b$ and we have $k(f)\jdeq j(g)$.
  However, for any $p$ we have $\idtoiso(p) = \trans{p}{1}$, so in particular $\idtoiso (j(g)) = \trans{j(g)}{1_{ia}}$.
  And by definition of $\hom_{\widehat A}$ on equalities, this is given by composing $1_{ia}$ with the equivalence $g$, hence is equal to $g$.

  \index{encode-decode method}%
  Note the similarity of this step to the encode-decode method\index{encode-decode method} used in \cref{sec:compute-coprod,sec:compute-nat,cha:homotopy}.
  Once again we are characterizing the identity types of a higher inductive type (here, $\widehat A_0$) by defining recursively a family of codes (here, $(x,y)\mapsto (x\cong y)$) and encoding and decoding functions by induction on $\widehat A_0$ and on paths.

  \mentalpause

  \emph{Step 4}: We define a weak equivalence $I:A \to \widehat A$.
  We take $I_0 \defeq i : A_0 \to \widehat A_0$, and by construction of $\hom_{\widehat A}$ we have functions $I_{a,b}:\hom_A(a,b) \to \hom_{\widehat A}(Ia,Ib)$ forming a functor $I:A \to \widehat A$.
  This functor is fully faithful by construction, so it remains to show it is essentially surjective.
  That is, for all $x:\widehat A$ we want there to merely exist an $a:A$ such that $Ia\cong x$.
  As always, we argue by induction on $x$, and since the goal is a mere proposition, all but the first constructor are trivial.
  But if $x$ is $ia$, then of course we have $a:A$ and $Ia\jdeq ia$, hence $Ia \cong ia$.
  (Note that if we were trying to prove $I$ to be \emph{split} essentially surjective, we would be stuck, because we know nothing about equalities in $A_0$ and thus have no way to deal with any further constructors.)
\end{proof}

We call the construction $A\mapsto \widehat A$ the \define{Rezk completion},
although there is also an argument (coming from higher topos semantics)
\index{.infinity1-topos@$(\infty,1)$-topos}%
for calling it the \define{stack completion}.
\index{stack}%
\index{completion!Rezk|)}%

We have seen that most precategories arising in practice are categories, since they are constructed from \uset, which is a category by the univalence axiom.
However, there are a few cases in which the Rezk completion is necessary to obtain a category.

\begin{eg}\label{ct:rezk-fundgpd-trunc1}
  Recall from \cref{ct:fundgpd} that for any type $X$ there is a pregroupoid with $X$ as its type of objects and $\hom(x,y) \defeq \pizero{x=y}$.
  \indexdef{fundamental!groupoid}%
  \index{fundamental!pregroupoid}%
  \indexsee{groupoid!fundamental}{fundamental group\-oid}%
  Its Rezk completion is the \emph{fundamental groupoid} of $X$.
  Recalling that group\-oids are equivalent to 1-types, it is not hard to identify this groupoid with $\trunc1X$.
\end{eg}

\begin{eg}\label{ct:hocat}
  Recall from \cref{ct:hoprecat} that there is a precategory whose type of objects is \type and with $\hom(X,Y) \defeq \pizero{X\to Y}$.
  Its Rezk completion may be called the \define{homotopy category of types}.
  \index{category!of types}%
  \index{homotopy!category of types@(pre)category of types}%
  Its type of objects can be identified with $\trunc1\type$ (see \cref{ct:ex:hocat}).
\end{eg}

The Rezk completion also allows us to show that the notion of ``category'' is determined by the notion of ``weak equivalence of precategories''.
Thus, insofar as the latter is inevitable, so is the former.

\begin{thm}\label{ct:weq-iso-precat-cat}
  A precategory $C$ is a category if and only if for every weak equivalence of precategories $H:A\to B$, the induced functor $(\blank\circ H):C^B \to C^A$ is an isomorphism of precategories.
\end{thm}
\begin{proof}
  ``Only if'' is \cref{ct:cat-weq-eq}.
  In the other direction, let $H$ be $I:A\to\widehat A$.
  Then since $(\blank\circ I)_0$ is an equivalence, there exists $R:\widehat A\to A$ such that $RI=1_A$.
  Hence $IRI=I$, but again since $(\blank\circ I)_0$ is an equivalence, this implies $IR =1_{\widehat A}$.
  By \cref{ct:isoprecat}\ref{item:ct:ipc3}, $I$ is an isomorphism of precategories.
  But then since $\widehat A$ is a category, so is $A$.
\end{proof}

\index{weak equivalence!of precategories|)}%


\newpage

\sectionNotes

The original definition of categories, of course, was in set-theoretic foundations, so that the collection of objects of a category formed a set (or, for large categories, a class).
Over time, it became clear that all ``category-theoretic'' properties of objects were invariant under isomorphism, and that equality of objects in a category was not usually a very useful notion.
Numerous authors~\cite{blanc:eqv-log,freyd:invar-eqv,makkai:folds,makkai:comparing} discovered that a dependently typed logic enabled formulating the definition of category without invoking any notion of equality for objects, and that the statements provable in this logic are precisely the ``category-theoretic'' ones that are invariant under isomorphism.
\index{evil}%

Although most of category theory appears to be invariant under isomorphism of objects and under equivalence of categories, there are some interesting exceptions, which have led to philosophical discussions about what it means to be ``category-theoretic''.
For instance, \cref{ct:galois} was brought up by Peter May on the categories mailing list in May 2010, as a case where it matters that two categories (defined as usual in set theory) are isomorphic rather than only equivalent.
The case of $\dagger$-categories was also somewhat confounding to those advocating an isomorphism-invariant version of category theory, since the ``correct'' notion of sameness between objects of a $\dagger$-category is not ordinary isomorphism but \emph{unitary} isomorphism.
\index{isomorphism!invariance under}%

Categories satisfying the ``saturation'' or ``univalence'' principle as in \cref{ct:category} were first considered by Hofmann and Streicher~\cite{hs:gpd-typethy}.
The condition then occurred independently to Voevodsky, Shulman, and perhaps others around the same time several years later, and was formalized by Ahrens and Kapulkin~\cite{aks:rezk}.
This framework puts all the above examples in a unified context: some precategories are categories, others are strict categories, and so on.
A general theorem that ``isomorphism implies equality'' for a large class of algebraic structures (assuming the univalence axiom) was proven by Coquand and Danielsson; the formulation of the structure identity principle in \cref{sec:sip} is due to Aczel.

Independently of philosophical considerations about category theory, Rezk~\cite{rezk01css} discovered that when defining a notion of $(\infty,1)$-cat\-e\-go\-ry,
\index{.infinity1-category@$(\infty,1)$-category}%
it was very convenient to use not merely a \emph{set} of objects with spaces of morphisms between them, but a \emph{space} of objects incorporating all the equivalences and homotopies between them.
This yields a very well-behaved sort of model for $(\infty,1)$-categories as particular simplicial spaces, which Rezk called \emph{complete Segal spaces}.
\index{complete!Segal space}%
\index{Segal!space}%
One especially good aspect of this model is the analogue of \cref{ct:eqv-levelwise}: a map of complete Segal spaces is an equivalence just when it is a levelwise equivalence of simplicial spaces.

When interpreted in Voevodsky's simplicial\index{simplicial!sets} set model of univalent foundations, our precategories are similar to a truncated analogue of Rezk's ``Segal spaces'', while our categories correspond to his ``complete Segal spaces''.
\index{Segal!category}%
Strict categories correspond instead to (a weakened and truncated version of) what are called ``Segal categories''.
It is known that Segal categories and complete Segal spaces are equivalent models for $(\infty,1)$-categories (see e.g.~\cite{bergner:infty-one}), so that in the simplicial set model, categories and strict categories yield ``equivalent'' category theories---although as we have seen, the former still have many advantages.
However, in the more general categorical semantics of a higher topos,
\index{.infinity1-topos@$(\infty,1)$-topos}%
a strict category corresponds to an internal category (in the traditional sense) in the corresponding 1-topos\index{topos} of sheaves, while a category corresponds to a \emph{stack}.
\index{stack}%
The latter are generally a more appropriate sort of ``category'' relative to a topos.

In Rezk's context, what we have called the ``Rezk completion'' corresponds to fibrant replacement
\index{fibrant replacement}
in the model category for complete Segal spaces.
Since this is built using a transfinite induction argument, it most closely matches our second construction as a higher inductive type.
However, in higher topos models of homotopy type theory, the Rezk completion corresponds to \emph{stack completion},\index{completion!stack}\index{stack!completion} which can be constructed either with a transfinite induction~\cite{jt:strong-stacks} or using a Yoneda embedding \cite{bunge:stacks-morita-internal}.


\sectionExercises

\begin{ex}\label{ex:slice-precategory}
  For a precategory $A$ and $a:A$, define the \define{slice precategory} $A/a$.
  \indexsee{precategory!slice}{category, slice}%
  \indexsee{slice (pre)category}{category, slice}%
  Show that if $A$ is a category, so is $A/a$.
  \indexdef{category!slice}%
\end{ex}

\begin{ex}\label{ex:set-slice-over-equiv-functor-category}
  For any set $X$, prove that the slice category $\uset/X$ is equivalent to the functor category $\uset^X$, where in the latter case we regard $X$ as a discrete category.
\end{ex}

\begin{ex}\label{ex:functor-equiv-right-adjoint}
  \index{adjoint!functor}%
  \index{adjoint!equivalence}%
  Prove that a functor is an equivalence of categories if and only if it is a \emph{right} adjoint whose unit and counit are isomorphisms.
\end{ex}

\begin{ex}\label{ct:pre2cat}
  Define the notion of \define{pre-2-category}.
  \indexdef{pre-2-category}%
  Show that precategories, functors, and natural transformations as defined in \cref{sec:transfors} form a pre-2-category.
  Similarly, define a \define{pre-bicategory}
  \indexdef{pre-bicategory}%
  by replacing the equalities (such as those in \cref{ct:functor-assoc,ct:units}) with natural isomorphisms satisfying analogous coherence conditions.
  Define a function from pre-2-categories to pre-bicategories, and show that it becomes an equivalence when restricted and corestricted to those whose hom-pre\-cat\-egories are categories.
\end{ex}

\begin{ex}\label{ct:2cat}
  Define a \define{2-category}
  \indexdef{2-category}%
  to be a pre-2-category satisfying a condition analogous to that of \cref{ct:category}.
  Verify that the pre-2-category of categories \ucat is a 2-category.
  How much of this chapter can be done internally to an arbitrary 2-category?
\end{ex}

\begin{ex}\label{ct:groupoids}
  Define a 2-category whose objects are 1-types, whose morphisms are functions, and whose 2-morphisms are homotopies.
  Prove that it is equivalent, in an appropriate sense, to the full sub-2-category of \ucat spanned by the \emph{groupoids} (categories in which every arrow is an isomorphism).
\end{ex}

\begin{ex}\label{ex:2strict-cat}
  \index{strict!category}%
  Recall that a \emph{strict category} is a precategory whose type of objects is a set.
  Prove that the pre-2-category of strict categories is equivalent to the following pre-2-category.
  \begin{itemize}
  \item Its objects are categories $A$ equipped with a surjection
    % \footnote{Recall that a function $f:X\to Y$ is a \emph{surjection} if for every $y:Y$, there \emph{merely exists} an $x:X$ such that $f(x)=y$.  This is to be distinguished from a \emph{split surjection}, which has the property that for every $y:Y$ there \emph{exists} an $x:X$ such that $f(x)=y$.}
    $p_A:A_0'\to A_0$, where $A_0'$ is a set.
  \item Its morphisms are functors $F:A\to B$ equipped with a function $F_0':A_0' \to B_0'$ such that $p_B \circ F_0' = F_0 \circ p_A$.
  \item Its 2-morphisms are simply natural transformations.
  \end{itemize}
\end{ex}

\begin{ex}\label{ex:pre2dagger-cat}
  Define the pre-2-category of $\dagger$-categories, which has $\dagger$-struc\-tures on its hom-pre\-cat\-egories.
  Show that two $\dagger$-categories are equal precisely when they are ``unitarily equivalent'' in a suitable sense.
\end{ex}

\begin{ex}\label{ct:ex:hocat}
  Prove that a function $X\to Y$ is an equivalence if and only if its image in the homotopy category of \cref{ct:hocat} is an isomorphism.
  Show that the type of objects of this category is $\trunc1\type$.
\end{ex}

\begin{ex}\label{ex:dagger-rezk}
  Construct the $\dagger$-Rezk completion of a $\dagger$-precategory into a $\dagger$-category, and give it an appropriate universal property.
\end{ex}

\begin{ex}\label{ex:rezk-vankampen}
  \index{van Kampen theorem}%
  \index{theorem!van Kampen}%
  \index{fundamental!groupoid}%
  \index{fundamental!pregroupoid}%
  Using fundamental (pre)groupoids from \cref{ct:fundgpd,ct:rezk-fundgpd-trunc1} and the Rezk completion from \cref{sec:rezk}, give a different proof of van Kampen's theorem (\cref{sec:van-kampen}).
\end{ex}

\begin{ex}\label{ex:stack}
  Let $X$ and $Y$ be sets and $p:Y\to X$ a surjection.
  \begin{enumerate}
  \item Define, for any precategory $A$, the category $\mathrm{Desc}(A,p)$ of \define{descent data}
    \indexdef{descent data}%
    in $A$ relative to $p$.
  \item Show that any precategory $A$ is a \define{prestack}
    \indexdef{prestack}%
    for $p$, i.e.\ the canonical functor $A^X \to \mathrm{Desc}(A,p)$ is fully faithful.
  \item Show that if $A$ is a category, then it is a \define{stack}
    \indexdef{stack}%
    for $p$, i.e.\ $A^X \to \mathrm{Desc}(A,p)$ is an equivalence.
  \item Show that the statement ``every strict category is a stack for every surjection of sets'' is equivalent to the axiom of choice.
    \index{axiom!of choice}%
    \index{strict!category}%
  \end{enumerate}
\end{ex}

% Local Variables:
% TeX-master: "hott-online"
% End:
